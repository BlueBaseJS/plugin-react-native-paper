e82320402169d466e313c5759454a19c
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var MetroListView = require('MetroListView');

var React = require('React');

var View = require('View');

var VirtualizedList = require('VirtualizedList');

var ListView = require('ListView');

var StyleSheet = require('StyleSheet');

var invariant = require('fbjs/lib/invariant');

var defaultProps = (0, _objectSpread2.default)({}, VirtualizedList.defaultProps, {
  numColumns: 1
});

var FlatList = function (_React$PureComponent) {
  (0, _inherits2.default)(FlatList, _React$PureComponent);
  (0, _createClass2.default)(FlatList, [{
    key: "scrollToEnd",
    value: function scrollToEnd(params) {
      if (this._listRef) {
        this._listRef.scrollToEnd(params);
      }
    }
  }, {
    key: "scrollToIndex",
    value: function scrollToIndex(params) {
      if (this._listRef) {
        this._listRef.scrollToIndex(params);
      }
    }
  }, {
    key: "scrollToItem",
    value: function scrollToItem(params) {
      if (this._listRef) {
        this._listRef.scrollToItem(params);
      }
    }
  }, {
    key: "scrollToOffset",
    value: function scrollToOffset(params) {
      if (this._listRef) {
        this._listRef.scrollToOffset(params);
      }
    }
  }, {
    key: "recordInteraction",
    value: function recordInteraction() {
      if (this._listRef) {
        this._listRef.recordInteraction();
      }
    }
  }, {
    key: "flashScrollIndicators",
    value: function flashScrollIndicators() {
      if (this._listRef) {
        this._listRef.flashScrollIndicators();
      }
    }
  }, {
    key: "getScrollResponder",
    value: function getScrollResponder() {
      if (this._listRef) {
        return this._listRef.getScrollResponder();
      }
    }
  }, {
    key: "getScrollableNode",
    value: function getScrollableNode() {
      if (this._listRef) {
        return this._listRef.getScrollableNode();
      }
    }
  }, {
    key: "setNativeProps",
    value: function setNativeProps(props) {
      if (this._listRef) {
        this._listRef.setNativeProps(props);
      }
    }
  }]);

  function FlatList(props) {
    var _this;

    (0, _classCallCheck2.default)(this, FlatList);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(FlatList).call(this, props));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_hasWarnedLegacy", false);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_virtualizedListPairs", []);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_captureRef", function (ref) {
      _this._listRef = ref;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_getItem", function (data, index) {
      var numColumns = _this.props.numColumns;

      if (numColumns > 1) {
        var ret = [];

        for (var kk = 0; kk < numColumns; kk++) {
          var _item = data[index * numColumns + kk];

          if (_item != null) {
            ret.push(_item);
          }
        }

        return ret;
      } else {
        return data[index];
      }
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_getItemCount", function (data) {
      return data ? Math.ceil(data.length / _this.props.numColumns) : 0;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_keyExtractor", function (items, index) {
      var _this$props = _this.props,
          keyExtractor = _this$props.keyExtractor,
          numColumns = _this$props.numColumns;

      if (numColumns > 1) {
        invariant(Array.isArray(items), 'FlatList: Encountered internal consistency error, expected each item to consist of an ' + 'array with 1-%s columns; instead, received a single item.', numColumns);
        return items.map(function (it, kk) {
          return keyExtractor(it, index * numColumns + kk);
        }).join(':');
      } else {
        return keyExtractor(items, index);
      }
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_renderItem", function (info) {
      var _this$props2 = _this.props,
          renderItem = _this$props2.renderItem,
          numColumns = _this$props2.numColumns,
          columnWrapperStyle = _this$props2.columnWrapperStyle;

      if (numColumns > 1) {
        var _item2 = info.item,
            _index = info.index;
        invariant(Array.isArray(_item2), 'Expected array of items with numColumns > 1');
        return React.createElement(View, {
          style: StyleSheet.compose(styles.row, columnWrapperStyle)
        }, _item2.map(function (it, kk) {
          var element = renderItem({
            item: it,
            index: _index * numColumns + kk,
            separators: info.separators
          });
          return element && React.cloneElement(element, {
            key: kk
          });
        }));
      } else {
        return renderItem(info);
      }
    });

    _this._checkProps(_this.props);

    if (_this.props.viewabilityConfigCallbackPairs) {
      _this._virtualizedListPairs = _this.props.viewabilityConfigCallbackPairs.map(function (pair) {
        return {
          viewabilityConfig: pair.viewabilityConfig,
          onViewableItemsChanged: _this._createOnViewableItemsChanged(pair.onViewableItemsChanged)
        };
      });
    } else if (_this.props.onViewableItemsChanged) {
      _this._virtualizedListPairs.push({
        viewabilityConfig: _this.props.viewabilityConfig,
        onViewableItemsChanged: _this._createOnViewableItemsChanged(_this.props.onViewableItemsChanged)
      });
    }

    return _this;
  }

  (0, _createClass2.default)(FlatList, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      invariant(prevProps.numColumns === this.props.numColumns, 'Changing numColumns on the fly is not supported. Change the key prop on FlatList when ' + 'changing the number of columns to force a fresh render of the component.');
      invariant(prevProps.onViewableItemsChanged === this.props.onViewableItemsChanged, 'Changing onViewableItemsChanged on the fly is not supported');
      invariant(prevProps.viewabilityConfig === this.props.viewabilityConfig, 'Changing viewabilityConfig on the fly is not supported');
      invariant(prevProps.viewabilityConfigCallbackPairs === this.props.viewabilityConfigCallbackPairs, 'Changing viewabilityConfigCallbackPairs on the fly is not supported');

      this._checkProps(this.props);
    }
  }, {
    key: "_checkProps",
    value: function _checkProps(props) {
      var getItem = props.getItem,
          getItemCount = props.getItemCount,
          horizontal = props.horizontal,
          legacyImplementation = props.legacyImplementation,
          numColumns = props.numColumns,
          columnWrapperStyle = props.columnWrapperStyle,
          onViewableItemsChanged = props.onViewableItemsChanged,
          viewabilityConfigCallbackPairs = props.viewabilityConfigCallbackPairs;
      invariant(!getItem && !getItemCount, 'FlatList does not support custom data formats.');

      if (numColumns > 1) {
        invariant(!horizontal, 'numColumns does not support horizontal.');
      } else {
        invariant(!columnWrapperStyle, 'columnWrapperStyle not supported for single column lists');
      }

      if (legacyImplementation) {
        invariant(numColumns === 1, 'Legacy list does not support multiple columns.');

        if (!this._hasWarnedLegacy) {
          console.warn('FlatList: legacyImplementation is deprecated and will be removed in a ' + 'future release - some features not supported and performance may suffer. ' + 'Please migrate to the default implementation.');
          this._hasWarnedLegacy = true;
        }
      }

      invariant(!(onViewableItemsChanged && viewabilityConfigCallbackPairs), 'FlatList does not support setting both onViewableItemsChanged and ' + 'viewabilityConfigCallbackPairs.');
    }
  }, {
    key: "_pushMultiColumnViewable",
    value: function _pushMultiColumnViewable(arr, v) {
      var _this$props3 = this.props,
          numColumns = _this$props3.numColumns,
          keyExtractor = _this$props3.keyExtractor;
      v.item.forEach(function (item, ii) {
        invariant(v.index != null, 'Missing index!');
        var index = v.index * numColumns + ii;
        arr.push((0, _objectSpread2.default)({}, v, {
          item: item,
          key: keyExtractor(item, index),
          index: index
        }));
      });
    }
  }, {
    key: "_createOnViewableItemsChanged",
    value: function _createOnViewableItemsChanged(onViewableItemsChanged) {
      var _this2 = this;

      return function (info) {
        var numColumns = _this2.props.numColumns;

        if (onViewableItemsChanged) {
          if (numColumns > 1) {
            var changed = [];
            var viewableItems = [];
            info.viewableItems.forEach(function (v) {
              return _this2._pushMultiColumnViewable(viewableItems, v);
            });
            info.changed.forEach(function (v) {
              return _this2._pushMultiColumnViewable(changed, v);
            });
            onViewableItemsChanged({
              viewableItems: viewableItems,
              changed: changed
            });
          } else {
            onViewableItemsChanged(info);
          }
        }
      };
    }
  }, {
    key: "render",
    value: function render() {
      if (this.props.legacyImplementation) {
        return React.createElement(MetroListView, (0, _extends2.default)({}, this.props, {
          items: this.props.data,
          ref: this._captureRef
        }));
      } else {
        return React.createElement(VirtualizedList, (0, _extends2.default)({}, this.props, {
          renderItem: this._renderItem,
          getItem: this._getItem,
          getItemCount: this._getItemCount,
          keyExtractor: this._keyExtractor,
          ref: this._captureRef,
          viewabilityConfigCallbackPairs: this._virtualizedListPairs
        }));
      }
    }
  }]);
  return FlatList;
}(React.PureComponent);

(0, _defineProperty2.default)(FlatList, "defaultProps", defaultProps);
var styles = StyleSheet.create({
  row: {
    flexDirection: 'row'
  }
});
module.exports = FlatList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZsYXRMaXN0LmpzIl0sIm5hbWVzIjpbIk1ldHJvTGlzdFZpZXciLCJyZXF1aXJlIiwiUmVhY3QiLCJWaWV3IiwiVmlydHVhbGl6ZWRMaXN0IiwiTGlzdFZpZXciLCJTdHlsZVNoZWV0IiwiaW52YXJpYW50IiwiZGVmYXVsdFByb3BzIiwibnVtQ29sdW1ucyIsIkZsYXRMaXN0IiwicGFyYW1zIiwiX2xpc3RSZWYiLCJzY3JvbGxUb0VuZCIsInNjcm9sbFRvSW5kZXgiLCJzY3JvbGxUb0l0ZW0iLCJzY3JvbGxUb09mZnNldCIsInJlY29yZEludGVyYWN0aW9uIiwiZmxhc2hTY3JvbGxJbmRpY2F0b3JzIiwiZ2V0U2Nyb2xsUmVzcG9uZGVyIiwiZ2V0U2Nyb2xsYWJsZU5vZGUiLCJwcm9wcyIsInNldE5hdGl2ZVByb3BzIiwicmVmIiwiZGF0YSIsImluZGV4IiwicmV0Iiwia2siLCJpdGVtIiwicHVzaCIsIk1hdGgiLCJjZWlsIiwibGVuZ3RoIiwiaXRlbXMiLCJrZXlFeHRyYWN0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdCIsImpvaW4iLCJpbmZvIiwicmVuZGVySXRlbSIsImNvbHVtbldyYXBwZXJTdHlsZSIsImNvbXBvc2UiLCJzdHlsZXMiLCJyb3ciLCJlbGVtZW50Iiwic2VwYXJhdG9ycyIsImNsb25lRWxlbWVudCIsImtleSIsIl9jaGVja1Byb3BzIiwidmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzIiwiX3ZpcnR1YWxpemVkTGlzdFBhaXJzIiwicGFpciIsInZpZXdhYmlsaXR5Q29uZmlnIiwib25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCIsIl9jcmVhdGVPblZpZXdhYmxlSXRlbXNDaGFuZ2VkIiwicHJldlByb3BzIiwiZ2V0SXRlbSIsImdldEl0ZW1Db3VudCIsImhvcml6b250YWwiLCJsZWdhY3lJbXBsZW1lbnRhdGlvbiIsIl9oYXNXYXJuZWRMZWdhY3kiLCJjb25zb2xlIiwid2FybiIsImFyciIsInYiLCJmb3JFYWNoIiwiaWkiLCJjaGFuZ2VkIiwidmlld2FibGVJdGVtcyIsIl9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZSIsIl9jYXB0dXJlUmVmIiwiX3JlbmRlckl0ZW0iLCJfZ2V0SXRlbSIsIl9nZXRJdGVtQ291bnQiLCJfa2V5RXh0cmFjdG9yIiwiUHVyZUNvbXBvbmVudCIsImNyZWF0ZSIsImZsZXhEaXJlY3Rpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFTQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGVBQUQsQ0FBN0I7O0FBQ0EsSUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxJQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLElBQU1HLGVBQWUsR0FBR0gsT0FBTyxDQUFDLGlCQUFELENBQS9COztBQUNBLElBQU1JLFFBQVEsR0FBR0osT0FBTyxDQUFDLFVBQUQsQ0FBeEI7O0FBQ0EsSUFBTUssVUFBVSxHQUFHTCxPQUFPLENBQUMsWUFBRCxDQUExQjs7QUFFQSxJQUFNTSxTQUFTLEdBQUdOLE9BQU8sQ0FBQyxvQkFBRCxDQUF6Qjs7QUFzTUEsSUFBTU8sWUFBWSxtQ0FDYkosZUFBZSxDQUFDSSxZQURIO0FBRWhCQyxFQUFBQSxVQUFVLEVBQUU7QUFGSSxFQUFsQjs7SUFrSE1DLFE7Ozs7Z0NBTVFDLE0sRUFBaUM7QUFDM0MsVUFBSSxLQUFLQyxRQUFULEVBQW1CO0FBQ2pCLGFBQUtBLFFBQUwsQ0FBY0MsV0FBZCxDQUEwQkYsTUFBMUI7QUFDRDtBQUNGOzs7a0NBVWFBLE0sRUFLWDtBQUNELFVBQUksS0FBS0MsUUFBVCxFQUFtQjtBQUVqQixhQUFLQSxRQUFMLENBQWNFLGFBQWQsQ0FBNEJILE1BQTVCO0FBQ0Q7QUFDRjs7O2lDQVFZQSxNLEVBSVY7QUFDRCxVQUFJLEtBQUtDLFFBQVQsRUFBbUI7QUFFakIsYUFBS0EsUUFBTCxDQUFjRyxZQUFkLENBQTJCSixNQUEzQjtBQUNEO0FB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LEdBQWlCdkUsUUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgTWV0cm9MaXN0VmlldyA9IHJlcXVpcmUoJ01ldHJvTGlzdFZpZXcnKTsgLy8gVXNlZCBhcyBhIGZhbGxiYWNrIGxlZ2FjeSBvcHRpb25cbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgnUmVhY3QnKTtcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCdWaWV3Jyk7XG5jb25zdCBWaXJ0dWFsaXplZExpc3QgPSByZXF1aXJlKCdWaXJ0dWFsaXplZExpc3QnKTtcbmNvbnN0IExpc3RWaWV3ID0gcmVxdWlyZSgnTGlzdFZpZXcnKTtcbmNvbnN0IFN0eWxlU2hlZXQgPSByZXF1aXJlKCdTdHlsZVNoZWV0Jyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG5pbXBvcnQgdHlwZSB7RGFuZ2Vyb3VzbHlJbXByZWNpc2VTdHlsZVByb3AsIFZpZXdTdHlsZVByb3B9IGZyb20gJ1N0eWxlU2hlZXQnO1xuaW1wb3J0IHR5cGUge1xuICBWaWV3YWJpbGl0eUNvbmZpZyxcbiAgVmlld1Rva2VuLFxuICBWaWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcixcbn0gZnJvbSAnVmlld2FiaWxpdHlIZWxwZXInO1xuaW1wb3J0IHR5cGUge1Byb3BzIGFzIFZpcnR1YWxpemVkTGlzdFByb3BzfSBmcm9tICdWaXJ0dWFsaXplZExpc3QnO1xuXG5leHBvcnQgdHlwZSBTZXBhcmF0b3JzT2JqID0ge1xuICBoaWdobGlnaHQ6ICgpID0+IHZvaWQsXG4gIHVuaGlnaGxpZ2h0OiAoKSA9PiB2b2lkLFxuICB1cGRhdGVQcm9wczogKHNlbGVjdDogJ2xlYWRpbmcnIHwgJ3RyYWlsaW5nJywgbmV3UHJvcHM6IE9iamVjdCkgPT4gdm9pZCxcbn07XG5cbnR5cGUgUmVxdWlyZWRQcm9wczxJdGVtVD4gPSB7XG4gIC8qKlxuICAgKiBUYWtlcyBhbiBpdGVtIGZyb20gYGRhdGFgIGFuZCByZW5kZXJzIGl0IGludG8gdGhlIGxpc3QuIEV4YW1wbGUgdXNhZ2U6XG4gICAqXG4gICAqICAgICA8RmxhdExpc3RcbiAgICogICAgICAgSXRlbVNlcGFyYXRvckNvbXBvbmVudD17UGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJyAmJiAoe2hpZ2hsaWdodGVkfSkgPT4gKFxuICAgKiAgICAgICAgIDxWaWV3IHN0eWxlPXtbc3R5bGUuc2VwYXJhdG9yLCBoaWdobGlnaHRlZCAmJiB7bWFyZ2luTGVmdDogMH1dfSAvPlxuICAgKiAgICAgICApfVxuICAgKiAgICAgICBkYXRhPXtbe3RpdGxlOiAnVGl0bGUgVGV4dCcsIGtleTogJ2l0ZW0xJ31dfVxuICAgKiAgICAgICByZW5kZXJJdGVtPXsoe2l0ZW0sIHNlcGFyYXRvcnN9KSA9PiAoXG4gICAqICAgICAgICAgPFRvdWNoYWJsZUhpZ2hsaWdodFxuICAgKiAgICAgICAgICAgb25QcmVzcz17KCkgPT4gdGhpcy5fb25QcmVzcyhpdGVtKX1cbiAgICogICAgICAgICAgIG9uU2hvd1VuZGVybGF5PXtzZXBhcmF0b3JzLmhpZ2hsaWdodH1cbiAgICogICAgICAgICAgIG9uSGlkZVVuZGVybGF5PXtzZXBhcmF0b3JzLnVuaGlnaGxpZ2h0fT5cbiAgICogICAgICAgICAgIDxWaWV3IHN0eWxlPXt7YmFja2dyb3VuZENvbG9yOiAnd2hpdGUnfX0+XG4gICAqICAgICAgICAgICAgIDxUZXh0PntpdGVtLnRpdGxlfTwvVGV4dD5cbiAgICogICAgICAgICAgIDwvVmlldz5cbiAgICogICAgICAgICA8L1RvdWNoYWJsZUhpZ2hsaWdodD5cbiAgICogICAgICAgKX1cbiAgICogICAgIC8+XG4gICAqXG4gICAqIFByb3ZpZGVzIGFkZGl0aW9uYWwgbWV0YWRhdGEgbGlrZSBgaW5kZXhgIGlmIHlvdSBuZWVkIGl0LCBhcyB3ZWxsIGFzIGEgbW9yZSBnZW5lcmljXG4gICAqIGBzZXBhcmF0b3JzLnVwZGF0ZVByb3BzYCBmdW5jdGlvbiB3aGljaCBsZXQncyB5b3Ugc2V0IHdoYXRldmVyIHByb3BzIHlvdSB3YW50IHRvIGNoYW5nZSB0aGVcbiAgICogcmVuZGVyaW5nIG9mIGVpdGhlciB0aGUgbGVhZGluZyBzZXBhcmF0b3Igb3IgdHJhaWxpbmcgc2VwYXJhdG9yIGluIGNhc2UgdGhlIG1vcmUgY29tbW9uXG4gICAqIGBoaWdobGlnaHRgIGFuZCBgdW5oaWdobGlnaHRgICh3aGljaCBzZXQgdGhlIGBoaWdobGlnaHRlZDogYm9vbGVhbmAgcHJvcCkgYXJlIGluc3VmZmljaWVudCBmb3JcbiAgICogeW91ciB1c2UtY2FzZS5cbiAgICovXG4gIHJlbmRlckl0ZW06IChpbmZvOiB7XG4gICAgaXRlbTogSXRlbVQsXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBzZXBhcmF0b3JzOiBTZXBhcmF0b3JzT2JqLFxuICB9KSA9PiA/UmVhY3QuRWxlbWVudDxhbnk+LFxuICAvKipcbiAgICogRm9yIHNpbXBsaWNpdHksIGRhdGEgaXMganVzdCBhIHBsYWluIGFycmF5LiBJZiB5b3Ugd2FudCB0byB1c2Ugc29tZXRoaW5nIGVsc2UsIGxpa2UgYW5cbiAgICogaW1tdXRhYmxlIGxpc3QsIHVzZSB0aGUgdW5kZXJseWluZyBgVmlydHVhbGl6ZWRMaXN0YCBkaXJlY3RseS5cbiAgICovXG4gIGRhdGE6ID8kUmVhZE9ubHlBcnJheTxJdGVtVD4sXG59O1xudHlwZSBPcHRpb25hbFByb3BzPEl0ZW1UPiA9IHtcbiAgLyoqXG4gICAqIFJlbmRlcmVkIGluIGJldHdlZW4gZWFjaCBpdGVtLCBidXQgbm90IGF0IHRoZSB0b3Agb3IgYm90dG9tLiBCeSBkZWZhdWx0LCBgaGlnaGxpZ2h0ZWRgIGFuZFxuICAgKiBgbGVhZGluZ0l0ZW1gIHByb3BzIGFyZSBwcm92aWRlZC4gYHJlbmRlckl0ZW1gIHByb3ZpZGVzIGBzZXBhcmF0b3JzLmhpZ2hsaWdodGAvYHVuaGlnaGxpZ2h0YFxuICAgKiB3aGljaCB3aWxsIHVwZGF0ZSB0aGUgYGhpZ2hsaWdodGVkYCBwcm9wLCBidXQgeW91IGNhbiBhbHNvIGFkZCBjdXN0b20gcHJvcHMgd2l0aFxuICAgKiBgc2VwYXJhdG9ycy51cGRhdGVQcm9wc2AuXG4gICAqL1xuICBJdGVtU2VwYXJhdG9yQ29tcG9uZW50PzogP1JlYWN0LkNvbXBvbmVudFR5cGU8YW55PixcbiAgLyoqXG4gICAqIFJlbmRlcmVkIHdoZW4gdGhlIGxpc3QgaXMgZW1wdHkuIENhbiBiZSBhIFJlYWN0IENvbXBvbmVudCBDbGFzcywgYSByZW5kZXIgZnVuY3Rpb24sIG9yXG4gICAqIGEgcmVuZGVyZWQgZWxlbWVudC5cbiAgICovXG4gIExpc3RFbXB0eUNvbXBvbmVudD86ID8oUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+IHwgUmVhY3QuRWxlbWVudDxhbnk+KSxcbiAgLyoqXG4gICAqIFJlbmRlcmVkIGF0IHRoZSBib3R0b20gb2YgYWxsIHRoZSBpdGVtcy4gQ2FuIGJlIGEgUmVhY3QgQ29tcG9uZW50IENsYXNzLCBhIHJlbmRlciBmdW5jdGlvbiwgb3JcbiAgICogYSByZW5kZXJlZCBlbGVtZW50LlxuICAgKi9cbiAgTGlzdEZvb3RlckNvbXBvbmVudD86ID8oUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+IHwgUmVhY3QuRWxlbWVudDxhbnk+KSxcbiAgLyoqXG4gICAqIFN0eWxpbmcgZm9yIGludGVybmFsIFZpZXcgZm9yIExpc3RGb290ZXJDb21wb25lbnRcbiAgICovXG4gIExpc3RGb290ZXJDb21wb25lbnRTdHlsZT86IFZpZXdTdHlsZVByb3AsXG4gIC8qKlxuICAgKiBSZW5kZXJlZCBhdCB0aGUgdG9wIG9mIGFsbCB0aGUgaXRlbXMuIENhbiBiZSBhIFJlYWN0IENvbXBvbmVudCBDbGFzcywgYSByZW5kZXIgZnVuY3Rpb24sIG9yXG4gICAqIGEgcmVuZGVyZWQgZWxlbWVudC5cbiAgICovXG4gIExpc3RIZWFkZXJDb21wb25lbnQ/OiA/KFJlYWN0LkNvbXBvbmVudFR5cGU8YW55PiB8IFJlYWN0LkVsZW1lbnQ8YW55PiksXG4gIC8qKlxuICAgKiBTdHlsaW5nIGZvciBpbnRlcm5hbCBWaWV3IGZvciBMaXN0SGVhZGVyQ29tcG9uZW50XG4gICAqL1xuICBMaXN0SGVhZGVyQ29tcG9uZW50U3R5bGU/OiBWaWV3U3R5bGVQcm9wLFxuICAvKipcbiAgICogT3B0aW9uYWwgY3VzdG9tIHN0eWxlIGZvciBtdWx0aS1pdGVtIHJvd3MgZ2VuZXJhdGVkIHdoZW4gbnVtQ29sdW1ucyA+IDEuXG4gICAqL1xuICBjb2x1bW5XcmFwcGVyU3R5bGU/OiBEYW5nZXJvdXNseUltcHJlY2lzZVN0eWxlUHJvcCxcbiAgLyoqXG4gICAqIEEgbWFya2VyIHByb3BlcnR5IGZvciB0ZWxsaW5nIHRoZSBsaXN0IHRvIHJlLXJlbmRlciAoc2luY2UgaXQgaW1wbGVtZW50cyBgUHVyZUNvbXBvbmVudGApLiBJZlxuICAgKiBhbnkgb2YgeW91ciBgcmVuZGVySXRlbWAsIEhlYWRlciwgRm9vdGVyLCBldGMuIGZ1bmN0aW9ucyBkZXBlbmQgb24gYW55dGhpbmcgb3V0c2lkZSBvZiB0aGVcbiAgICogYGRhdGFgIHByb3AsIHN0aWNrIGl0IGhlcmUgYW5kIHRyZWF0IGl0IGltbXV0YWJseS5cbiAgICovXG4gIGV4dHJhRGF0YT86IGFueSxcbiAgLyoqXG4gICAqIGBnZXRJdGVtTGF5b3V0YCBpcyBhbiBvcHRpb25hbCBvcHRpbWl6YXRpb25zIHRoYXQgbGV0IHVzIHNraXAgbWVhc3VyZW1lbnQgb2YgZHluYW1pYyBjb250ZW50IGlmXG4gICAqIHlvdSBrbm93IHRoZSBoZWlnaHQgb2YgaXRlbXMgYSBwcmlvcmkuIGBnZXRJdGVtTGF5b3V0YCBpcyB0aGUgbW9zdCBlZmZpY2llbnQsIGFuZCBpcyBlYXN5IHRvXG4gICAqIHVzZSBpZiB5b3UgaGF2ZSBmaXhlZCBoZWlnaHQgaXRlbXMsIGZvciBleGFtcGxlOlxuICAgKlxuICAgKiAgICAgZ2V0SXRlbUxheW91dD17KGRhdGEsIGluZGV4KSA9PiAoXG4gICAqICAgICAgIHtsZW5ndGg6IElURU1fSEVJR0hULCBvZmZzZXQ6IElURU1fSEVJR0hUICogaW5kZXgsIGluZGV4fVxuICAgKiAgICAgKX1cbiAgICpcbiAgICogQWRkaW5nIGBnZXRJdGVtTGF5b3V0YCBjYW4gYmUgYSBncmVhdCBwZXJmb3JtYW5jZSBib29zdCBmb3IgbGlzdHMgb2Ygc2V2ZXJhbCBodW5kcmVkIGl0ZW1zLlxuICAgKiBSZW1lbWJlciB0byBpbmNsdWRlIHNlcGFyYXRvciBsZW5ndGggKGhlaWdodCBvciB3aWR0aCkgaW4geW91ciBvZmZzZXQgY2FsY3VsYXRpb24gaWYgeW91XG4gICAqIHNwZWNpZnkgYEl0ZW1TZXBhcmF0b3JDb21wb25lbnRgLlxuICAgKi9cbiAgZ2V0SXRlbUxheW91dD86IChcbiAgICBkYXRhOiA/QXJyYXk8SXRlbVQ+LFxuICAgIGluZGV4OiBudW1iZXIsXG4gICkgPT4ge2xlbmd0aDogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciwgaW5kZXg6IG51bWJlcn0sXG4gIC8qKlxuICAgKiBJZiB0cnVlLCByZW5kZXJzIGl0ZW1zIG5leHQgdG8gZWFjaCBvdGhlciBob3Jpem9udGFsbHkgaW5zdGVhZCBvZiBzdGFja2VkIHZlcnRpY2FsbHkuXG4gICAqL1xuICBob3Jpem9udGFsPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBIb3cgbWFueSBpdGVtcyB0byByZW5kZXIgaW4gdGhlIGluaXRpYWwgYmF0Y2guIFRoaXMgc2hvdWxkIGJlIGVub3VnaCB0byBmaWxsIHRoZSBzY3JlZW4gYnV0IG5vdFxuICAgKiBtdWNoIG1vcmUuIE5vdGUgdGhlc2UgaXRlbXMgd2lsbCBuZXZlciBiZSB1bm1vdW50ZWQgYXMgcGFydCBvZiB0aGUgd2luZG93ZWQgcmVuZGVyaW5nIGluIG9yZGVyXG4gICAqIHRvIGltcHJvdmUgcGVyY2VpdmVkIHBlcmZvcm1hbmNlIG9mIHNjcm9sbC10by10b3AgYWN0aW9ucy5cbiAgICovXG4gIGluaXRpYWxOdW1Ub1JlbmRlcjogbnVtYmVyLFxuICAvKipcbiAgICogSW5zdGVhZCBvZiBzdGFydGluZyBhdCB0aGUgdG9wIHdpdGggdGhlIGZpcnN0IGl0ZW0sIHN0YXJ0IGF0IGBpbml0aWFsU2Nyb2xsSW5kZXhgLiBUaGlzXG4gICAqIGRpc2FibGVzIHRoZSBcInNjcm9sbCB0byB0b3BcIiBvcHRpbWl6YXRpb24gdGhhdCBrZWVwcyB0aGUgZmlyc3QgYGluaXRpYWxOdW1Ub1JlbmRlcmAgaXRlbXNcbiAgICogYWx3YXlzIHJlbmRlcmVkIGFuZCBpbW1lZGlhdGVseSByZW5kZXJzIHRoZSBpdGVtcyBzdGFydGluZyBhdCB0aGlzIGluaXRpYWwgaW5kZXguIFJlcXVpcmVzXG4gICAqIGBnZXRJdGVtTGF5b3V0YCB0byBiZSBpbXBsZW1lbnRlZC5cbiAgICovXG4gIGluaXRpYWxTY3JvbGxJbmRleD86ID9udW1iZXIsXG4gIC8qKlxuICAgKiBSZXZlcnNlcyB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC4gVXNlcyBzY2FsZSB0cmFuc2Zvcm1zIG9mIC0xLlxuICAgKi9cbiAgaW52ZXJ0ZWQ/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIFVzZWQgdG8gZXh0cmFjdCBhIHVuaXF1ZSBrZXkgZm9yIGEgZ2l2ZW4gaXRlbSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LiBLZXkgaXMgdXNlZCBmb3IgY2FjaGluZ1xuICAgKiBhbmQgYXMgdGhlIHJlYWN0IGtleSB0byB0cmFjayBpdGVtIHJlLW9yZGVyaW5nLiBUaGUgZGVmYXVsdCBleHRyYWN0b3IgY2hlY2tzIGBpdGVtLmtleWAsIHRoZW5cbiAgICogZmFsbHMgYmFjayB0byB1c2luZyB0aGUgaW5kZXgsIGxpa2UgUmVhY3QgZG9lcy5cbiAgICovXG4gIGtleUV4dHJhY3RvcjogKGl0ZW06IEl0ZW1ULCBpbmRleDogbnVtYmVyKSA9PiBzdHJpbmcsXG4gIC8qKlxuICAgKiBNdWx0aXBsZSBjb2x1bW5zIGNhbiBvbmx5IGJlIHJlbmRlcmVkIHdpdGggYGhvcml6b250YWw9e2ZhbHNlfWAgYW5kIHdpbGwgemlnLXphZyBsaWtlIGFcbiAgICogYGZsZXhXcmFwYCBsYXlvdXQuIEl0ZW1zIHNob3VsZCBhbGwgYmUgdGhlIHNhbWUgaGVpZ2h0IC0gbWFzb25yeSBsYXlvdXRzIGFyZSBub3Qgc3VwcG9ydGVkLlxuICAgKi9cbiAgbnVtQ29sdW1uczogbnVtYmVyLFxuICAvKipcbiAgICogQ2FsbGVkIG9uY2Ugd2hlbiB0aGUgc2Nyb2xsIHBvc2l0aW9uIGdldHMgd2l0aGluIGBvbkVuZFJlYWNoZWRUaHJlc2hvbGRgIG9mIHRoZSByZW5kZXJlZFxuICAgKiBjb250ZW50LlxuICAgKi9cbiAgb25FbmRSZWFjaGVkPzogPyhpbmZvOiB7ZGlzdGFuY2VGcm9tRW5kOiBudW1iZXJ9KSA9PiB2b2lkLFxuICAvKipcbiAgICogSG93IGZhciBmcm9tIHRoZSBlbmQgKGluIHVuaXRzIG9mIHZpc2libGUgbGVuZ3RoIG9mIHRoZSBsaXN0KSB0aGUgYm90dG9tIGVkZ2Ugb2YgdGhlXG4gICAqIGxpc3QgbXVzdCBiZSBmcm9tIHRoZSBlbmQgb2YgdGhlIGNvbnRlbnQgdG8gdHJpZ2dlciB0aGUgYG9uRW5kUmVhY2hlZGAgY2FsbGJhY2suXG4gICAqIFRodXMgYSB2YWx1ZSBvZiAwLjUgd2lsbCB0cmlnZ2VyIGBvbkVuZFJlYWNoZWRgIHdoZW4gdGhlIGVuZCBvZiB0aGUgY29udGVudCBpc1xuICAgKiB3aXRoaW4gaGFsZiB0aGUgdmlzaWJsZSBsZW5ndGggb2YgdGhlIGxpc3QuXG4gICAqL1xuICBvbkVuZFJlYWNoZWRUaHJlc2hvbGQ/OiA/bnVtYmVyLFxuICAvKipcbiAgICogSWYgcHJvdmlkZWQsIGEgc3RhbmRhcmQgUmVmcmVzaENvbnRyb2wgd2lsbCBiZSBhZGRlZCBmb3IgXCJQdWxsIHRvIFJlZnJlc2hcIiBmdW5jdGlvbmFsaXR5LiBNYWtlXG4gICAqIHN1cmUgdG8gYWxzbyBzZXQgdGhlIGByZWZyZXNoaW5nYCBwcm9wIGNvcnJlY3RseS5cbiAgICovXG4gIG9uUmVmcmVzaD86ID8oKSA9PiB2b2lkLFxuICAvKipcbiAgICogQ2FsbGVkIHdoZW4gdGhlIHZpZXdhYmlsaXR5IG9mIHJvd3MgY2hhbmdlcywgYXMgZGVmaW5lZCBieSB0aGUgYHZpZXdhYmlsaXR5Q29uZmlnYCBwcm9wLlxuICAgKi9cbiAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZD86ID8oaW5mbzoge1xuICAgIHZpZXdhYmxlSXRlbXM6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgfSkgPT4gdm9pZCxcbiAgLyoqXG4gICAqIFNldCB0aGlzIHdoZW4gb2Zmc2V0IGlzIG5lZWRlZCBmb3IgdGhlIGxvYWRpbmcgaW5kaWNhdG9yIHRvIHNob3cgY29ycmVjdGx5LlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgcHJvZ3Jlc3NWaWV3T2Zmc2V0PzogbnVtYmVyLFxuICBsZWdhY3lJbXBsZW1lbnRhdGlvbj86ID9ib29sZWFuLFxuICAvKipcbiAgICogU2V0IHRoaXMgdHJ1ZSB3aGlsZSB3YWl0aW5nIGZvciBuZXcgZGF0YSBmcm9tIGEgcmVmcmVzaC5cbiAgICovXG4gIHJlZnJlc2hpbmc/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIE5vdGU6IG1heSBoYXZlIGJ1Z3MgKG1pc3NpbmcgY29udGVudCkgaW4gc29tZSBjaXJjdW1zdGFuY2VzIC0gdXNlIGF0IHlvdXIgb3duIHJpc2suXG4gICAqXG4gICAqIFRoaXMgbWF5IGltcHJvdmUgc2Nyb2xsIHBlcmZvcm1hbmNlIGZvciBsYXJnZSBsaXN0cy5cbiAgICovXG4gIHJlbW92ZUNsaXBwZWRTdWJ2aWV3cz86IGJvb2xlYW4sXG4gIC8qKlxuICAgKiBTZWUgYFZpZXdhYmlsaXR5SGVscGVyYCBmb3IgZmxvdyB0eXBlIGFuZCBmdXJ0aGVyIGRvY3VtZW50YXRpb24uXG4gICAqL1xuICB2aWV3YWJpbGl0eUNvbmZpZz86IFZpZXdhYmlsaXR5Q29uZmlnLFxuICAvKipcbiAgICogTGlzdCBvZiBWaWV3YWJpbGl0eUNvbmZpZy9vblZpZXdhYmxlSXRlbXNDaGFuZ2VkIHBhaXJzLiBBIHNwZWNpZmljIG9uVmlld2FibGVJdGVtc0NoYW5nZWRcbiAgICogd2lsbCBiZSBjYWxsZWQgd2hlbiBpdHMgY29ycmVzcG9uZGluZyBWaWV3YWJpbGl0eUNvbmZpZydzIGNvbmRpdGlvbnMgYXJlIG1ldC5cbiAgICovXG4gIHZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycz86IEFycmF5PFZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlyPixcbn07XG5leHBvcnQgdHlwZSBQcm9wczxJdGVtVD4gPSBSZXF1aXJlZFByb3BzPEl0ZW1UPiAmXG4gIE9wdGlvbmFsUHJvcHM8SXRlbVQ+ICZcbiAgVmlydHVhbGl6ZWRMaXN0UHJvcHM7XG5cbmNvbnN0IGRlZmF1bHRQcm9wcyA9IHtcbiAgLi4uVmlydHVhbGl6ZWRMaXN0LmRlZmF1bHRQcm9wcyxcbiAgbnVtQ29sdW1uczogMSxcbn07XG5leHBvcnQgdHlwZSBEZWZhdWx0UHJvcHMgPSB0eXBlb2YgZGVmYXVsdFByb3BzO1xuXG4vKipcbiAqIEEgcGVyZm9ybWFudCBpbnRlcmZhY2UgZm9yIHJlbmRlcmluZyBzaW1wbGUsIGZsYXQgbGlzdHMsIHN1cHBvcnRpbmcgdGhlIG1vc3QgaGFuZHkgZmVhdHVyZXM6XG4gKlxuICogIC0gRnVsbHkgY3Jvc3MtcGxhdGZvcm0uXG4gKiAgLSBPcHRpb25hbCBob3Jpem9udGFsIG1vZGUuXG4gKiAgLSBDb25maWd1cmFibGUgdmlld2FiaWxpdHkgY2FsbGJhY2tzLlxuICogIC0gSGVhZGVyIHN1cHBvcnQuXG4gKiAgLSBGb290ZXIgc3VwcG9ydC5cbiAqICAtIFNlcGFyYXRvciBzdXBwb3J0LlxuICogIC0gUHVsbCB0byBSZWZyZXNoLlxuICogIC0gU2Nyb2xsIGxvYWRpbmcuXG4gKiAgLSBTY3JvbGxUb0luZGV4IHN1cHBvcnQuXG4gKlxuICogSWYgeW91IG5lZWQgc2VjdGlvbiBzdXBwb3J0LCB1c2UgW2A8U2VjdGlvbkxpc3Q+YF0oZG9jcy9zZWN0aW9ubGlzdC5odG1sKS5cbiAqXG4gKiBNaW5pbWFsIEV4YW1wbGU6XG4gKlxuICogICAgIDxGbGF0TGlzdFxuICogICAgICAgZGF0YT17W3trZXk6ICdhJ30sIHtrZXk6ICdiJ31dfVxuICogICAgICAgcmVuZGVySXRlbT17KHtpdGVtfSkgPT4gPFRleHQ+e2l0ZW0ua2V5fTwvVGV4dD59XG4gKiAgICAgLz5cbiAqXG4gKiBNb3JlIGNvbXBsZXgsIG11bHRpLXNlbGVjdCBleGFtcGxlIGRlbW9uc3RyYXRpbmcgYFB1cmVDb21wb25lbnRgIHVzYWdlIGZvciBwZXJmIG9wdGltaXphdGlvbiBhbmQgYXZvaWRpbmcgYnVncy5cbiAqXG4gKiAtIEJ5IGJpbmRpbmcgdGhlIGBvblByZXNzSXRlbWAgaGFuZGxlciwgdGhlIHByb3BzIHdpbGwgcmVtYWluIGA9PT1gIGFuZCBgUHVyZUNvbXBvbmVudGAgd2lsbFxuICogICBwcmV2ZW50IHdhc3RlZnVsIHJlLXJlbmRlcnMgdW5sZXNzIHRoZSBhY3R1YWwgYGlkYCwgYHNlbGVjdGVkYCwgb3IgYHRpdGxlYCBwcm9wcyBjaGFuZ2UsIGV2ZW5cbiAqICAgaWYgdGhlIGNvbXBvbmVudHMgcmVuZGVyZWQgaW4gYE15TGlzdEl0ZW1gIGRpZCBub3QgaGF2ZSBzdWNoIG9wdGltaXphdGlvbnMuXG4gKiAtIEJ5IHBhc3NpbmcgYGV4dHJhRGF0YT17dGhpcy5zdGF0ZX1gIHRvIGBGbGF0TGlzdGAgd2UgbWFrZSBzdXJlIGBGbGF0TGlzdGAgaXRzZWxmIHdpbGwgcmUtcmVuZGVyXG4gKiAgIHdoZW4gdGhlIGBzdGF0ZS5zZWxlY3RlZGAgY2hhbmdlcy4gV2l0aG91dCBzZXR0aW5nIHRoaXMgcHJvcCwgYEZsYXRMaXN0YCB3b3VsZCBub3Qga25vdyBpdFxuICogICBuZWVkcyB0byByZS1yZW5kZXIgYW55IGl0ZW1zIGJlY2F1c2UgaXQgaXMgYWxzbyBhIGBQdXJlQ29tcG9uZW50YCBhbmQgdGhlIHByb3AgY29tcGFyaXNvbiB3aWxsXG4gKiAgIG5vdCBzaG93IGFueSBjaGFuZ2VzLlxuICogLSBga2V5RXh0cmFjdG9yYCB0ZWxscyB0aGUgbGlzdCB0byB1c2UgdGhlIGBpZGBzIGZvciB0aGUgcmVhY3Qga2V5cyBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IGBrZXlgIHByb3BlcnR5LlxuICpcbiAqXG4gKiAgICAgY2xhc3MgTXlMaXN0SXRlbSBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICogICAgICAgX29uUHJlc3MgPSAoKSA9PiB7XG4gKiAgICAgICAgIHRoaXMucHJvcHMub25QcmVzc0l0ZW0odGhpcy5wcm9wcy5pZCk7XG4gKiAgICAgICB9O1xuICpcbiAqICAgICAgIHJlbmRlcigpIHtcbiAqICAgICAgICAgY29uc3QgdGV4dENvbG9yID0gdGhpcy5wcm9wcy5zZWxlY3RlZCA/IFwicmVkXCIgOiBcImJsYWNrXCI7XG4gKiAgICAgICAgIHJldHVybiAoXG4gKiAgICAgICAgICAgPFRvdWNoYWJsZU9wYWNpdHkgb25QcmVzcz17dGhpcy5fb25QcmVzc30+XG4gKiAgICAgICAgICAgICA8Vmlldz5cbiAqICAgICAgICAgICAgICAgPFRleHQgc3R5bGU9e3sgY29sb3I6IHRleHRDb2xvciB9fT5cbiAqICAgICAgICAgICAgICAgICB7dGhpcy5wcm9wcy50aXRsZX1cbiAqICAgICAgICAgICAgICAgPC9UZXh0PlxuICogICAgICAgICAgICAgPC9WaWV3PlxuICogICAgICAgICAgIDwvVG91Y2hhYmxlT3BhY2l0eT5cbiAqICAgICAgICAgKTtcbiAqICAgICAgIH1cbiAqICAgICB9XG4gKlxuICogICAgIGNsYXNzIE11bHRpU2VsZWN0TGlzdCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICogICAgICAgc3RhdGUgPSB7c2VsZWN0ZWQ6IChuZXcgTWFwKCk6IE1hcDxzdHJpbmcsIGJvb2xlYW4+KX07XG4gKlxuICogICAgICAgX2tleUV4dHJhY3RvciA9IChpdGVtLCBpbmRleCkgPT4gaXRlbS5pZDtcbiAqXG4gKiAgICAgICBfb25QcmVzc0l0ZW0gPSAoaWQ6IHN0cmluZykgPT4ge1xuICogICAgICAgICAvLyB1cGRhdGVyIGZ1bmN0aW9ucyBhcmUgcHJlZmVycmVkIGZvciB0cmFuc2FjdGlvbmFsIHVwZGF0ZXNcbiAqICAgICAgICAgdGhpcy5zZXRTdGF0ZSgoc3RhdGUpID0+IHtcbiAqICAgICAgICAgICAvLyBjb3B5IHRoZSBtYXAgcmF0aGVyIHRoYW4gbW9kaWZ5aW5nIHN0YXRlLlxuICogICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gbmV3IE1hcChzdGF0ZS5zZWxlY3RlZCk7XG4gKiAgICAgICAgICAgc2VsZWN0ZWQuc2V0KGlkLCAhc2VsZWN0ZWQuZ2V0KGlkKSk7IC8vIHRvZ2dsZVxuICogICAgICAgICAgIHJldHVybiB7c2VsZWN0ZWR9O1xuICogICAgICAgICB9KTtcbiAqICAgICAgIH07XG4gKlxuICogICAgICAgX3JlbmRlckl0ZW0gPSAoe2l0ZW19KSA9PiAoXG4gKiAgICAgICAgIDxNeUxpc3RJdGVtXG4gKiAgICAgICAgICAgaWQ9e2l0ZW0uaWR9XG4gKiAgICAgICAgICAgb25QcmVzc0l0ZW09e3RoaXMuX29uUHJlc3NJdGVtfVxuICogICAgICAgICAgIHNlbGVjdGVkPXshIXRoaXMuc3RhdGUuc2VsZWN0ZWQuZ2V0KGl0ZW0uaWQpfVxuICogICAgICAgICAgIHRpdGxlPXtpdGVtLnRpdGxlfVxuICogICAgICAgICAvPlxuICogICAgICAgKTtcbiAqXG4gKiAgICAgICByZW5kZXIoKSB7XG4gKiAgICAgICAgIHJldHVybiAoXG4gKiAgICAgICAgICAgPEZsYXRMaXN0XG4gKiAgICAgICAgICAgICBkYXRhPXt0aGlzLnByb3BzLmRhdGF9XG4gKiAgICAgICAgICAgICBleHRyYURhdGE9e3RoaXMuc3RhdGV9XG4gKiAgICAgICAgICAgICBrZXlFeHRyYWN0b3I9e3RoaXMuX2tleUV4dHJhY3Rvcn1cbiAqICAgICAgICAgICAgIHJlbmRlckl0ZW09e3RoaXMuX3JlbmRlckl0ZW19XG4gKiAgICAgICAgICAgLz5cbiAqICAgICAgICAgKTtcbiAqICAgICAgIH1cbiAqICAgICB9XG4gKlxuICogVGhpcyBpcyBhIGNvbnZlbmllbmNlIHdyYXBwZXIgYXJvdW5kIFtgPFZpcnR1YWxpemVkTGlzdD5gXShkb2NzL3ZpcnR1YWxpemVkbGlzdC5odG1sKSxcbiAqIGFuZCB0aHVzIGluaGVyaXRzIGl0cyBwcm9wcyAoYXMgd2VsbCBhcyB0aG9zZSBvZiBgU2Nyb2xsVmlld2ApIHRoYXQgYXJlbid0IGV4cGxpY2l0bHkgbGlzdGVkXG4gKiBoZXJlLCBhbG9uZyB3aXRoIHRoZSBmb2xsb3dpbmcgY2F2ZWF0czpcbiAqXG4gKiAtIEludGVybmFsIHN0YXRlIGlzIG5vdCBwcmVzZXJ2ZWQgd2hlbiBjb250ZW50IHNjcm9sbHMgb3V0IG9mIHRoZSByZW5kZXIgd2luZG93LiBNYWtlIHN1cmUgYWxsXG4gKiAgIHlvdXIgZGF0YSBpcyBjYXB0dXJlZCBpbiB0aGUgaXRlbSBkYXRhIG9yIGV4dGVybmFsIHN0b3JlcyBsaWtlIEZsdXgsIFJlZHV4LCBvciBSZWxheS5cbiAqIC0gVGhpcyBpcyBhIGBQdXJlQ29tcG9uZW50YCB3aGljaCBtZWFucyB0aGF0IGl0IHdpbGwgbm90IHJlLXJlbmRlciBpZiBgcHJvcHNgIHJlbWFpbiBzaGFsbG93LVxuICogICBlcXVhbC4gTWFrZSBzdXJlIHRoYXQgZXZlcnl0aGluZyB5b3VyIGByZW5kZXJJdGVtYCBmdW5jdGlvbiBkZXBlbmRzIG9uIGlzIHBhc3NlZCBhcyBhIHByb3BcbiAqICAgKGUuZy4gYGV4dHJhRGF0YWApIHRoYXQgaXMgbm90IGA9PT1gIGFmdGVyIHVwZGF0ZXMsIG90aGVyd2lzZSB5b3VyIFVJIG1heSBub3QgdXBkYXRlIG9uXG4gKiAgIGNoYW5nZXMuIFRoaXMgaW5jbHVkZXMgdGhlIGBkYXRhYCBwcm9wIGFuZCBwYXJlbnQgY29tcG9uZW50IHN0YXRlLlxuICogLSBJbiBvcmRlciB0byBjb25zdHJhaW4gbWVtb3J5IGFuZCBlbmFibGUgc21vb3RoIHNjcm9sbGluZywgY29udGVudCBpcyByZW5kZXJlZCBhc3luY2hyb25vdXNseVxuICogICBvZmZzY3JlZW4uIFRoaXMgbWVhbnMgaXQncyBwb3NzaWJsZSB0byBzY3JvbGwgZmFzdGVyIHRoYW4gdGhlIGZpbGwgcmF0ZSBhbmRzIG1vbWVudGFyaWx5IHNlZVxuICogICBibGFuayBjb250ZW50LiBUaGlzIGlzIGEgdHJhZGVvZmYgdGhhdCBjYW4gYmUgYWRqdXN0ZWQgdG8gc3VpdCB0aGUgbmVlZHMgb2YgZWFjaCBhcHBsaWNhdGlvbixcbiAqICAgYW5kIHdlIGFyZSB3b3JraW5nIG9uIGltcHJvdmluZyBpdCBiZWhpbmQgdGhlIHNjZW5lcy5cbiAqIC0gQnkgZGVmYXVsdCwgdGhlIGxpc3QgbG9va3MgZm9yIGEgYGtleWAgcHJvcCBvbiBlYWNoIGl0ZW0gYW5kIHVzZXMgdGhhdCBmb3IgdGhlIFJlYWN0IGtleS5cbiAqICAgQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBwcm92aWRlIGEgY3VzdG9tIGBrZXlFeHRyYWN0b3JgIHByb3AuXG4gKlxuICogQWxzbyBpbmhlcml0cyBbU2Nyb2xsVmlldyBQcm9wc10oZG9jcy9zY3JvbGx2aWV3Lmh0bWwjcHJvcHMpLCB1bmxlc3MgaXQgaXMgbmVzdGVkIGluIGFub3RoZXIgRmxhdExpc3Qgb2Ygc2FtZSBvcmllbnRhdGlvbi5cbiAqL1xuY2xhc3MgRmxhdExpc3Q8SXRlbVQ+IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxQcm9wczxJdGVtVD4sIHZvaWQ+IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wczogRGVmYXVsdFByb3BzID0gZGVmYXVsdFByb3BzO1xuICBwcm9wczogUHJvcHM8SXRlbVQ+O1xuICAvKipcbiAgICogU2Nyb2xscyB0byB0aGUgZW5kIG9mIHRoZSBjb250ZW50LiBNYXkgYmUgamFua3kgd2l0aG91dCBgZ2V0SXRlbUxheW91dGAgcHJvcC5cbiAgICovXG4gIHNjcm9sbFRvRW5kKHBhcmFtcz86ID97YW5pbWF0ZWQ/OiA/Ym9vbGVhbn0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb0VuZChwYXJhbXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGxzIHRvIHRoZSBpdGVtIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXggc3VjaCB0aGF0IGl0IGlzIHBvc2l0aW9uZWQgaW4gdGhlIHZpZXdhYmxlIGFyZWFcbiAgICogc3VjaCB0aGF0IGB2aWV3UG9zaXRpb25gIDAgcGxhY2VzIGl0IGF0IHRoZSB0b3AsIDEgYXQgdGhlIGJvdHRvbSwgYW5kIDAuNSBjZW50ZXJlZCBpbiB0aGVcbiAgICogbWlkZGxlLiBgdmlld09mZnNldGAgaXMgYSBmaXhlZCBudW1iZXIgb2YgcGl4ZWxzIHRvIG9mZnNldCB0aGUgZmluYWwgdGFyZ2V0IHBvc2l0aW9uLlxuICAgKlxuICAgKiBOb3RlOiBjYW5ub3Qgc2Nyb2xsIHRvIGxvY2F0aW9ucyBvdXRzaWRlIHRoZSByZW5kZXIgd2luZG93IHdpdGhvdXQgc3BlY2lmeWluZyB0aGVcbiAgICogYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0luZGV4KHBhcmFtczoge1xuICAgIGFuaW1hdGVkPzogP2Jvb2xlYW4sXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICB2aWV3T2Zmc2V0PzogbnVtYmVyLFxuICAgIHZpZXdQb3NpdGlvbj86IG51bWJlcixcbiAgfSkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICAvLyAkRmxvd0ZpeE1lIEZvdW5kIHdoZW4gdHlwaW5nIExpc3RWaWV3XG4gICAgICB0aGlzLl9saXN0UmVmLnNjcm9sbFRvSW5kZXgocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVxdWlyZXMgbGluZWFyIHNjYW4gdGhyb3VnaCBkYXRhIC0gdXNlIGBzY3JvbGxUb0luZGV4YCBpbnN0ZWFkIGlmIHBvc3NpYmxlLlxuICAgKlxuICAgKiBOb3RlOiBjYW5ub3Qgc2Nyb2xsIHRvIGxvY2F0aW9ucyBvdXRzaWRlIHRoZSByZW5kZXIgd2luZG93IHdpdGhvdXQgc3BlY2lmeWluZyB0aGVcbiAgICogYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0l0ZW0ocGFyYW1zOiB7XG4gICAgYW5pbWF0ZWQ/OiA/Ym9vbGVhbixcbiAgICBpdGVtOiBJdGVtVCxcbiAgICB2aWV3UG9zaXRpb24/OiBudW1iZXIsXG4gIH0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgLy8gJEZsb3dGaXhNZSBGb3VuZCB3aGVuIHR5cGluZyBMaXN0Vmlld1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb0l0ZW0ocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2Nyb2xsIHRvIGEgc3BlY2lmaWMgY29udGVudCBwaXhlbCBvZmZzZXQgaW4gdGhlIGxpc3QuXG4gICAqXG4gICAqIENoZWNrIG91dCBbc2Nyb2xsVG9PZmZzZXRdKGRvY3MvdmlydHVhbGl6ZWRsaXN0Lmh0bWwjc2Nyb2xsdG9vZmZzZXQpIG9mIFZpcnR1YWxpemVkTGlzdFxuICAgKi9cbiAgc2Nyb2xsVG9PZmZzZXQocGFyYW1zOiB7YW5pbWF0ZWQ/OiA/Ym9vbGVhbiwgb2Zmc2V0OiBudW1iZXJ9KSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIC8vICRGbG93Rml4TWUgRm91bmQgd2hlbiB0eXBpbmcgTGlzdFZpZXdcbiAgICAgIHRoaXMuX2xpc3RSZWYuc2Nyb2xsVG9PZmZzZXQocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGVsbHMgdGhlIGxpc3QgYW4gaW50ZXJhY3Rpb24gaGFzIG9jY3VycmVkLCB3aGljaCBzaG91bGQgdHJpZ2dlciB2aWV3YWJpbGl0eSBjYWxjdWxhdGlvbnMsIGUuZy5cbiAgICogaWYgYHdhaXRGb3JJbnRlcmFjdGlvbnNgIGlzIHRydWUgYW5kIHRoZSB1c2VyIGhhcyBub3Qgc2Nyb2xsZWQuIFRoaXMgaXMgdHlwaWNhbGx5IGNhbGxlZCBieVxuICAgKiB0YXBzIG9uIGl0ZW1zIG9yIGJ5IG5hdmlnYXRpb24gYWN0aW9ucy5cbiAgICovXG4gIHJlY29yZEludGVyYWN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICAvLyAkRmxvd0ZpeE1lIEZvdW5kIHdoZW4gdHlwaW5nIExpc3RWaWV3XG4gICAgICB0aGlzLl9saXN0UmVmLnJlY29yZEludGVyYWN0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3BsYXlzIHRoZSBzY3JvbGwgaW5kaWNhdG9ycyBtb21lbnRhcmlseS5cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgZmxhc2hTY3JvbGxJbmRpY2F0b3JzKCkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICAvLyAkRmxvd0ZpeE1lIEZvdW5kIHdoZW4gdHlwaW5nIExpc3RWaWV3XG4gICAgICB0aGlzLl9saXN0UmVmLmZsYXNoU2Nyb2xsSW5kaWNhdG9ycygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBhIGhhbmRsZSB0byB0aGUgdW5kZXJseWluZyBzY3JvbGwgcmVzcG9uZGVyLlxuICAgKi9cbiAgZ2V0U2Nyb2xsUmVzcG9uZGVyKCkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICAvLyAkRmxvd0ZpeE1lIEZvdW5kIHdoZW4gdHlwaW5nIExpc3RWaWV3XG4gICAgICByZXR1cm4gdGhpcy5fbGlzdFJlZi5nZXRTY3JvbGxSZXNwb25kZXIoKTtcbiAgICB9XG4gIH1cblxuICBnZXRTY3JvbGxhYmxlTm9kZSgpIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgLy8gJEZsb3dGaXhNZSBGb3VuZCB3aGVuIHR5cGluZyBMaXN0Vmlld1xuICAgICAgcmV0dXJuIHRoaXMuX2xpc3RSZWYuZ2V0U2Nyb2xsYWJsZU5vZGUoKTtcbiAgICB9XG4gIH1cblxuICBzZXROYXRpdmVQcm9wcyhwcm9wczoge1tzdHJpbmddOiBtaXhlZH0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zZXROYXRpdmVQcm9wcyhwcm9wcyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzPEl0ZW1UPikge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLl9jaGVja1Byb3BzKHRoaXMucHJvcHMpO1xuICAgIGlmICh0aGlzLnByb3BzLnZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycykge1xuICAgICAgdGhpcy5fdmlydHVhbGl6ZWRMaXN0UGFpcnMgPSB0aGlzLnByb3BzLnZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycy5tYXAoXG4gICAgICAgIHBhaXIgPT4gKHtcbiAgICAgICAgICB2aWV3YWJpbGl0eUNvbmZpZzogcGFpci52aWV3YWJpbGl0eUNvbmZpZyxcbiAgICAgICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkOiB0aGlzLl9jcmVhdGVPblZpZXdhYmxlSXRlbXNDaGFuZ2VkKFxuICAgICAgICAgICAgcGFpci5vblZpZXdhYmxlSXRlbXNDaGFuZ2VkLFxuICAgICAgICAgICksXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCkge1xuICAgICAgLyogJEZsb3dGaXhNZSg+PTAuNjMuMCBzaXRlPXJlYWN0X25hdGl2ZV9mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAgICAgICAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC42MyB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IgZGVsZXRlIHRoaXNcbiAgICAgICAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgdGhpcy5fdmlydHVhbGl6ZWRMaXN0UGFpcnMucHVzaCh7XG4gICAgICAgIHZpZXdhYmlsaXR5Q29uZmlnOiB0aGlzLnByb3BzLnZpZXdhYmlsaXR5Q29uZmlnLFxuICAgICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkOiB0aGlzLl9jcmVhdGVPblZpZXdhYmxlSXRlbXNDaGFuZ2VkKFxuICAgICAgICAgIHRoaXMucHJvcHMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICAgKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzPEl0ZW1UPikge1xuICAgIGludmFyaWFudChcbiAgICAgIHByZXZQcm9wcy5udW1Db2x1bW5zID09PSB0aGlzLnByb3BzLm51bUNvbHVtbnMsXG4gICAgICAnQ2hhbmdpbmcgbnVtQ29sdW1ucyBvbiB0aGUgZmx5IGlzIG5vdCBzdXBwb3J0ZWQuIENoYW5nZSB0aGUga2V5IHByb3Agb24gRmxhdExpc3Qgd2hlbiAnICtcbiAgICAgICAgJ2NoYW5naW5nIHRoZSBudW1iZXIgb2YgY29sdW1ucyB0byBmb3JjZSBhIGZyZXNoIHJlbmRlciBvZiB0aGUgY29tcG9uZW50LicsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwcmV2UHJvcHMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCA9PT0gdGhpcy5wcm9wcy5vblZpZXdhYmxlSXRlbXNDaGFuZ2VkLFxuICAgICAgJ0NoYW5naW5nIG9uVmlld2FibGVJdGVtc0NoYW5nZWQgb24gdGhlIGZseSBpcyBub3Qgc3VwcG9ydGVkJyxcbiAgICApO1xuICAgIGludmFyaWFudChcbiAgICAgIHByZXZQcm9wcy52aWV3YWJpbGl0eUNvbmZpZyA9PT0gdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZyxcbiAgICAgICdDaGFuZ2luZyB2aWV3YWJpbGl0eUNvbmZpZyBvbiB0aGUgZmx5IGlzIG5vdCBzdXBwb3J0ZWQnLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgcHJldlByb3BzLnZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyA9PT1cbiAgICAgICAgdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMsXG4gICAgICAnQ2hhbmdpbmcgdmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzIG9uIHRoZSBmbHkgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgKTtcblxuICAgIHRoaXMuX2NoZWNrUHJvcHModGhpcy5wcm9wcyk7XG4gIH1cblxuICBfaGFzV2FybmVkTGVnYWN5ID0gZmFsc2U7XG4gIF9saXN0UmVmOiBudWxsIHwgVmlydHVhbGl6ZWRMaXN0IHwgTGlzdFZpZXcgfCBNZXRyb0xpc3RWaWV3O1xuICBfdmlydHVhbGl6ZWRMaXN0UGFpcnM6IEFycmF5PFZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlyPiA9IFtdO1xuXG4gIF9jYXB0dXJlUmVmID0gcmVmID0+IHtcbiAgICB0aGlzLl9saXN0UmVmID0gcmVmO1xuICB9O1xuXG4gIF9jaGVja1Byb3BzKHByb3BzOiBQcm9wczxJdGVtVD4pIHtcbiAgICBjb25zdCB7XG4gICAgICBnZXRJdGVtLFxuICAgICAgZ2V0SXRlbUNvdW50LFxuICAgICAgaG9yaXpvbnRhbCxcbiAgICAgIGxlZ2FjeUltcGxlbWVudGF0aW9uLFxuICAgICAgbnVtQ29sdW1ucyxcbiAgICAgIGNvbHVtbldyYXBwZXJTdHlsZSxcbiAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQsXG4gICAgICB2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMsXG4gICAgfSA9IHByb3BzO1xuICAgIGludmFyaWFudChcbiAgICAgICFnZXRJdGVtICYmICFnZXRJdGVtQ291bnQsXG4gICAgICAnRmxhdExpc3QgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gZGF0YSBmb3JtYXRzLicsXG4gICAgKTtcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGludmFyaWFudCghaG9yaXpvbnRhbCwgJ251bUNvbHVtbnMgZG9lcyBub3Qgc3VwcG9ydCBob3Jpem9udGFsLicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgICFjb2x1bW5XcmFwcGVyU3R5bGUsXG4gICAgICAgICdjb2x1bW5XcmFwcGVyU3R5bGUgbm90IHN1cHBvcnRlZCBmb3Igc2luZ2xlIGNvbHVtbiBsaXN0cycsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAobGVnYWN5SW1wbGVtZW50YXRpb24pIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgbnVtQ29sdW1ucyA9PT0gMSxcbiAgICAgICAgJ0xlZ2FjeSBsaXN0IGRvZXMgbm90IHN1cHBvcnQgbXVsdGlwbGUgY29sdW1ucy4nLFxuICAgICAgKTtcbiAgICAgIC8vIFdhcm5pbmc6IG1heSBub3QgaGF2ZSBmdWxsIGZlYXR1cmUgcGFyaXR5IGFuZCBpcyBtZWFudCBtb3JlIGZvciBkZWJ1Z2dpbmcgYW5kIHBlcmZvcm1hbmNlXG4gICAgICAvLyBjb21wYXJpc29uLlxuICAgICAgaWYgKCF0aGlzLl9oYXNXYXJuZWRMZWdhY3kpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICdGbGF0TGlzdDogbGVnYWN5SW1wbGVtZW50YXRpb24gaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgJyArXG4gICAgICAgICAgICAnZnV0dXJlIHJlbGVhc2UgLSBzb21lIGZlYXR1cmVzIG5vdCBzdXBwb3J0ZWQgYW5kIHBlcmZvcm1hbmNlIG1heSBzdWZmZXIuICcgK1xuICAgICAgICAgICAgJ1BsZWFzZSBtaWdyYXRlIHRvIHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uLicsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX2hhc1dhcm5lZExlZ2FjeSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGludmFyaWFudChcbiAgICAgICEob25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCAmJiB2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMpLFxuICAgICAgJ0ZsYXRMaXN0IGRvZXMgbm90IHN1cHBvcnQgc2V0dGluZyBib3RoIG9uVmlld2FibGVJdGVtc0NoYW5nZWQgYW5kICcgK1xuICAgICAgICAndmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzLicsXG4gICAgKTtcbiAgfVxuXG4gIF9nZXRJdGVtID0gKGRhdGE6IEFycmF5PEl0ZW1UPiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHtudW1Db2x1bW5zfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICBjb25zdCByZXQgPSBbXTtcbiAgICAgIGZvciAobGV0IGtrID0gMDsga2sgPCBudW1Db2x1bW5zOyBraysrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2luZGV4ICogbnVtQ29sdW1ucyArIGtrXTtcbiAgICAgICAgaWYgKGl0ZW0gIT0gbnVsbCkge1xuICAgICAgICAgIHJldC5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGF0YVtpbmRleF07XG4gICAgfVxuICB9O1xuXG4gIF9nZXRJdGVtQ291bnQgPSAoZGF0YTogP0FycmF5PEl0ZW1UPik6IG51bWJlciA9PiB7XG4gICAgcmV0dXJuIGRhdGEgPyBNYXRoLmNlaWwoZGF0YS5sZW5ndGggLyB0aGlzLnByb3BzLm51bUNvbHVtbnMpIDogMDtcbiAgfTtcblxuICBfa2V5RXh0cmFjdG9yID0gKGl0ZW1zOiBJdGVtVCB8IEFycmF5PEl0ZW1UPiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHtrZXlFeHRyYWN0b3IsIG51bUNvbHVtbnN9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgQXJyYXkuaXNBcnJheShpdGVtcyksXG4gICAgICAgICdGbGF0TGlzdDogRW5jb3VudGVyZWQgaW50ZXJuYWwgY29uc2lzdGVuY3kgZXJyb3IsIGV4cGVjdGVkIGVhY2ggaXRlbSB0byBjb25zaXN0IG9mIGFuICcgK1xuICAgICAgICAgICdhcnJheSB3aXRoIDEtJXMgY29sdW1uczsgaW5zdGVhZCwgcmVjZWl2ZWQgYSBzaW5nbGUgaXRlbS4nLFxuICAgICAgICBudW1Db2x1bW5zLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBpdGVtc1xuICAgICAgICAubWFwKChpdCwga2spID0+IGtleUV4dHJhY3RvcihpdCwgaW5kZXggKiBudW1Db2x1bW5zICsga2spKVxuICAgICAgICAuam9pbignOicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvKiAkRmxvd0ZpeE1lKD49MC42My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjYzIHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciBkZWxldGUgdGhpc1xuICAgICAgICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG4gICAgICByZXR1cm4ga2V5RXh0cmFjdG9yKGl0ZW1zLCBpbmRleCk7XG4gICAgfVxuICB9O1xuXG4gIF9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZShhcnI6IEFycmF5PFZpZXdUb2tlbj4sIHY6IFZpZXdUb2tlbik6IHZvaWQge1xuICAgIGNvbnN0IHtudW1Db2x1bW5zLCBrZXlFeHRyYWN0b3J9ID0gdGhpcy5wcm9wcztcbiAgICB2Lml0ZW0uZm9yRWFjaCgoaXRlbSwgaWkpID0+IHtcbiAgICAgIGludmFyaWFudCh2LmluZGV4ICE9IG51bGwsICdNaXNzaW5nIGluZGV4IScpO1xuICAgICAgY29uc3QgaW5kZXggPSB2LmluZGV4ICogbnVtQ29sdW1ucyArIGlpO1xuICAgICAgYXJyLnB1c2goey4uLnYsIGl0ZW0sIGtleToga2V5RXh0cmFjdG9yKGl0ZW0sIGluZGV4KSwgaW5kZXh9KTtcbiAgICB9KTtcbiAgfVxuXG4gIF9jcmVhdGVPblZpZXdhYmxlSXRlbXNDaGFuZ2VkKFxuICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ6ID8oaW5mbzoge1xuICAgICAgdmlld2FibGVJdGVtczogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgfSkgPT4gdm9pZCxcbiAgKSB7XG4gICAgcmV0dXJuIChpbmZvOiB7XG4gICAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCB7bnVtQ29sdW1uc30gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uVmlld2FibGVJdGVtc0NoYW5nZWQpIHtcbiAgICAgICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICAgICAgY29uc3QgY2hhbmdlZCA9IFtdO1xuICAgICAgICAgIGNvbnN0IHZpZXdhYmxlSXRlbXMgPSBbXTtcbiAgICAgICAgICBpbmZvLnZpZXdhYmxlSXRlbXMuZm9yRWFjaCh2ID0+XG4gICAgICAgICAgICB0aGlzLl9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZSh2aWV3YWJsZUl0ZW1zLCB2KSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGluZm8uY2hhbmdlZC5mb3JFYWNoKHYgPT4gdGhpcy5fcHVzaE11bHRpQ29sdW1uVmlld2FibGUoY2hhbmdlZCwgdikpO1xuICAgICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQoe3ZpZXdhYmxlSXRlbXMsIGNoYW5nZWR9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkKGluZm8pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIF9yZW5kZXJJdGVtID0gKGluZm86IE9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHtyZW5kZXJJdGVtLCBudW1Db2x1bW5zLCBjb2x1bW5XcmFwcGVyU3R5bGV9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGNvbnN0IHtpdGVtLCBpbmRleH0gPSBpbmZvO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBBcnJheS5pc0FycmF5KGl0ZW0pLFxuICAgICAgICAnRXhwZWN0ZWQgYXJyYXkgb2YgaXRlbXMgd2l0aCBudW1Db2x1bW5zID4gMScsXG4gICAgICApO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFZpZXdcbiAgICAgICAgICBzdHlsZT17U3R5bGVTaGVldC5jb21wb3NlKFxuICAgICAgICAgICAgc3R5bGVzLnJvdyxcbiAgICAgICAgICAgIGNvbHVtbldyYXBwZXJTdHlsZSxcbiAgICAgICAgICApfT5cbiAgICAgICAgICB7aXRlbS5tYXAoKGl0LCBraykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHJlbmRlckl0ZW0oe1xuICAgICAgICAgICAgICBpdGVtOiBpdCxcbiAgICAgICAgICAgICAgaW5kZXg6IGluZGV4ICogbnVtQ29sdW1ucyArIGtrLFxuICAgICAgICAgICAgICBzZXBhcmF0b3JzOiBpbmZvLnNlcGFyYXRvcnMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50ICYmIFJlYWN0LmNsb25lRWxlbWVudChlbGVtZW50LCB7a2V5OiBra30pO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmVuZGVySXRlbShpbmZvKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLnByb3BzLmxlZ2FjeUltcGxlbWVudGF0aW9uKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAkRmxvd0ZpeE1lKD49MC42Ni4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuNjYgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yIGRlbGV0ZVxuICAgICAgICAgKiB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgICA8TWV0cm9MaXN0Vmlld1xuICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgIC8qICRGbG93Rml4TWUoPj0wLjY2LjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzXG4gICAgICAgICAgICogYW4gZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjY2IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvclxuICAgICAgICAgICAqIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgICAgIGl0ZW1zPXt0aGlzLnByb3BzLmRhdGF9XG4gICAgICAgICAgcmVmPXt0aGlzLl9jYXB0dXJlUmVmfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFZpcnR1YWxpemVkTGlzdFxuICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgIHJlbmRlckl0ZW09e3RoaXMuX3JlbmRlckl0ZW19XG4gICAgICAgICAgZ2V0SXRlbT17dGhpcy5fZ2V0SXRlbX1cbiAgICAgICAgICBnZXRJdGVtQ291bnQ9e3RoaXMuX2dldEl0ZW1Db3VudH1cbiAgICAgICAgICBrZXlFeHRyYWN0b3I9e3RoaXMuX2tleUV4dHJhY3Rvcn1cbiAgICAgICAgICByZWY9e3RoaXMuX2NhcHR1cmVSZWZ9XG4gICAgICAgICAgdmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzPXt0aGlzLl92aXJ0dWFsaXplZExpc3RQYWlyc31cbiAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgcm93OiB7ZmxleERpcmVjdGlvbjogJ3Jvdyd9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRmxhdExpc3Q7XG4iXX0=