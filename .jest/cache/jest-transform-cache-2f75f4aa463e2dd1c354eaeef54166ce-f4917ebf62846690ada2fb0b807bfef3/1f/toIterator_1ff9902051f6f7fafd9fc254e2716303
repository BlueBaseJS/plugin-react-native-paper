b749d0b616a6a98db9a23639b8eb8225
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var KIND_KEY = 'key';
var KIND_VALUE = 'value';
var KIND_KEY_VAL = 'key+value';
var ITERATOR_SYMBOL = typeof Symbol === 'function' ? typeof Symbol === "function" ? Symbol.iterator : "@@iterator" : '@@iterator';

var toIterator = function () {
  if (!(Array.prototype[ITERATOR_SYMBOL] && String.prototype[ITERATOR_SYMBOL])) {
    return function () {
      var ArrayIterator = function () {
        function ArrayIterator(array, kind) {
          (0, _classCallCheck2.default)(this, ArrayIterator);

          if (!Array.isArray(array)) {
            throw new TypeError('Object is not an Array');
          }

          this._iteratedObject = array;
          this._kind = kind;
          this._nextIndex = 0;
        }

        (0, _createClass2.default)(ArrayIterator, [{
          key: "next",
          value: function next() {
            if (!this instanceof ArrayIterator) {
              throw new TypeError('Object is not an ArrayIterator');
            }

            if (this._iteratedObject == null) {
              return createIterResultObject(undefined, true);
            }

            var array = this._iteratedObject;
            var len = this._iteratedObject.length;
            var index = this._nextIndex;
            var kind = this._kind;

            if (index >= len) {
              this._iteratedObject = undefined;
              return createIterResultObject(undefined, true);
            }

            this._nextIndex = index + 1;

            if (kind === KIND_KEY) {
              return createIterResultObject(index, false);
            } else if (kind === KIND_VALUE) {
              return createIterResultObject(array[index], false);
            } else if (kind === KIND_KEY_VAL) {
              return createIterResultObject([index, array[index]], false);
            }
          }
        }, {
          key: '@@iterator',
          value: function iterator() {
            return this;
          }
        }]);
        return ArrayIterator;
      }();

      var StringIterator = function () {
        function StringIterator(string) {
          (0, _classCallCheck2.default)(this, StringIterator);

          if (typeof string !== 'string') {
            throw new TypeError('Object is not a string');
          }

          this._iteratedString = string;
          this._nextIndex = 0;
        }

        (0, _createClass2.default)(StringIterator, [{
          key: "next",
          value: function next() {
            if (!this instanceof StringIterator) {
              throw new TypeError('Object is not a StringIterator');
            }

            if (this._iteratedString == null) {
              return createIterResultObject(undefined, true);
            }

            var index = this._nextIndex;
            var s = this._iteratedString;
            var len = s.length;

            if (index >= len) {
              this._iteratedString = undefined;
              return createIterResultObject(undefined, true);
            }

            var ret;
            var first = s.charCodeAt(index);

            if (first < 0xd800 || first > 0xdbff || index + 1 === len) {
              ret = s[index];
            } else {
              var second = s.charCodeAt(index + 1);

              if (second < 0xdc00 || second > 0xdfff) {
                ret = s[index];
              } else {
                ret = s[index] + s[index + 1];
              }
            }

            this._nextIndex = index + ret.length;
            return createIterResultObject(ret, false);
          }
        }, {
          key: '@@iterator',
          value: function iterator() {
            return this;
          }
        }]);
        return StringIterator;
      }();

      function createIterResultObject(value, done) {
        return {
          value: value,
          done: done
        };
      }

      return function (object, kind) {
        if (typeof object === 'string') {
          return new StringIterator(object);
        } else if (Array.isArray(object)) {
          return new ArrayIterator(object, kind || KIND_VALUE);
        } else {
          return object[ITERATOR_SYMBOL]();
        }
      };
    }();
  } else {
    return function (object) {
      return object[ITERATOR_SYMBOL]();
    };
  }
}();

(0, _extends2.default)(toIterator, {
  KIND_KEY: KIND_KEY,
  KIND_VALUE: KIND_VALUE,
  KIND_KEY_VAL: KIND_KEY_VAL,
  ITERATOR_SYMBOL: ITERATOR_SYMBOL
});
module.exports = toIterator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvSXRlcmF0b3IuanMiXSwibmFtZXMiOlsiS0lORF9LRVkiLCJLSU5EX1ZBTFVFIiwiS0lORF9LRVlfVkFMIiwiSVRFUkFUT1JfU1lNQk9MIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJ0b0l0ZXJhdG9yIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJTdHJpbmciLCJBcnJheUl0ZXJhdG9yIiwiYXJyYXkiLCJraW5kIiwiaXNBcnJheSIsIlR5cGVFcnJvciIsIl9pdGVyYXRlZE9iamVjdCIsIl9raW5kIiwiX25leHRJbmRleCIsImNyZWF0ZUl0ZXJSZXN1bHRPYmplY3QiLCJ1bmRlZmluZWQiLCJsZW4iLCJsZW5ndGgiLCJpbmRleCIsIlN0cmluZ0l0ZXJhdG9yIiwic3RyaW5nIiwiX2l0ZXJhdGVkU3RyaW5nIiwicyIsInJldCIsImZpcnN0IiwiY2hhckNvZGVBdCIsInNlY29uZCIsInZhbHVlIiwiZG9uZSIsIm9iamVjdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVNBOzs7Ozs7Ozs7O0FBWUEsSUFBTUEsUUFBUSxHQUFHLEtBQWpCO0FBQ0EsSUFBTUMsVUFBVSxHQUFHLE9BQW5CO0FBQ0EsSUFBTUMsWUFBWSxHQUFHLFdBQXJCO0FBRUEsSUFBTUMsZUFBZSxHQUNuQixPQUFPQyxNQUFQLEtBQWtCLFVBQWxCLGtDQUErQkEsTUFBTSxDQUFDQyxRQUF0QyxrQkFBaUQsWUFEbkQ7O0FBR0EsSUFBTUMsVUFBVSxHQUFJLFlBQVc7QUFDN0IsTUFDRSxFQUFFQyxLQUFLLENBQUNDLFNBQU4sQ0FBZ0JMLGVBQWhCLEtBQW9DTSxNQUFNLENBQUNELFNBQVAsQ0FBaUJMLGVBQWpCLENBQXRDLENBREYsRUFFRTtBQUVBLFdBQVEsWUFBVztBQUFBLFVBQ1hPLGFBRFc7QUFHZiwrQkFBWUMsS0FBWixFQUFtQkMsSUFBbkIsRUFBeUI7QUFBQTs7QUFDdkIsY0FBSSxDQUFDTCxLQUFLLENBQUNNLE9BQU4sQ0FBY0YsS0FBZCxDQUFMLEVBQTJCO0FBQ3pCLGtC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QUlYLFVBQWxDLENBQVA7QUFDRCxTQUZNLE1BRUE7QUFDTCxpQkFBT2dDLE1BQU0sQ0FBQzlCLGVBQUQsQ0FBTixFQUFQO0FBQ0Q7QUFDRixPQVJEO0FBU0QsS0FySE0sRUFBUDtBQXNIRCxHQTFIRCxNQTBITztBQUNMLFdBQU8sVUFBUzhCLE1BQVQsRUFBaUI7QUFDdEIsYUFBT0EsTUFBTSxDQUFDOUIsZUFBRCxDQUFOLEVBQVA7QUFDRCxLQUZEO0FBR0Q7QUFDRixDQWhJa0IsRUFBbkI7O0FBc0lBLHVCQUFjRyxVQUFkLEVBQTBCO0FBQ3hCTixFQUFBQSxRQUFRLEVBQVJBLFFBRHdCO0FBRXhCQyxFQUFBQSxVQUFVLEVBQVZBLFVBRndCO0FBR3hCQyxFQUFBQSxZQUFZLEVBQVpBLFlBSHdCO0FBSXhCQyxFQUFBQSxlQUFlLEVBQWZBO0FBSndCLENBQTFCO0FBT0ErQixNQUFNLENBQUNDLE9BQVAsR0FBaUI3QixVQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBHaXZlbiBhbiBvYmplY3QgYHRvSXRlcmF0b3JgIHdpbGwgcmV0dXJuIHRoZSBpdHJhdG9yIGZvciB0aGF0IG9iamVjdC4gSWYgdGhlXG4gKiBvYmplY3QgaGFzIGEgYFN5bWJvbC5pdGVyYXRvcmAgbWV0aG9kIHdlIGp1c3QgY2FsbCB0aGF0LiBPdGhlcndpc2Ugd2VcbiAqIGltcGxlbWVudCB0aGUgRVM2IGBBcnJheWAgYW5kIGBTdHJpbmdgIEl0ZXJhdG9yLlxuICovXG5cbi8qKlxuICogQ29uc3RhbnRzXG4gKi9cblxuY29uc3QgS0lORF9LRVkgPSAna2V5JztcbmNvbnN0IEtJTkRfVkFMVUUgPSAndmFsdWUnO1xuY29uc3QgS0lORF9LRVlfVkFMID0gJ2tleSt2YWx1ZSc7XG4vKmdsb2JhbCBTeW1ib2w6IHRydWUqL1xuY29uc3QgSVRFUkFUT1JfU1lNQk9MID1cbiAgdHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyA/IFN5bWJvbC5pdGVyYXRvciA6ICdAQGl0ZXJhdG9yJztcblxuY29uc3QgdG9JdGVyYXRvciA9IChmdW5jdGlvbigpIHtcbiAgaWYgKFxuICAgICEoQXJyYXkucHJvdG90eXBlW0lURVJBVE9SX1NZTUJPTF0gJiYgU3RyaW5nLnByb3RvdHlwZVtJVEVSQVRPUl9TWU1CT0xdKVxuICApIHtcbiAgICAvLyBJSUZFIHRvIGF2b2lkIGNyZWF0aW5nIGNsYXNzZXMgZm9yIG5vIHJlYXNvbiBiZWNhdXNlIG9mIGhvaXN0aW5nLlxuICAgIHJldHVybiAoZnVuY3Rpb24oKSB7XG4gICAgICBjbGFzcyBBcnJheUl0ZXJhdG9yIHtcbiAgICAgICAgLy8gMjIuMS41LjEgQ3JlYXRlQXJyYXlJdGVyYXRvciBBYnN0cmFjdCBPcGVyYXRpb25cbiAgICAgICAgY29uc3RydWN0b3IoYXJyYXksIGtpbmQpIHtcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyYXkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3QgaXMgbm90IGFuIEFycmF5Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuX2l0ZXJhdGVkT2JqZWN0ID0gYXJyYXk7XG4gICAgICAgICAgdGhpcy5fa2luZCA9IGtpbmQ7XG4gICAgICAgICAgdGhpcy5fbmV4dEluZGV4ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDIyLjEuNS4yLjEgJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKVxuICAgICAgICBuZXh0KCkge1xuICAgICAgICAgIGlmICghdGhpcyBpbnN0YW5jZW9mIEFycmF5SXRlcmF0b3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdCBpcyBub3QgYW4gQXJyYXlJdGVyYXRvcicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLl9pdGVyYXRlZE9iamVjdCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlclJlc3VsdE9iamVjdCh1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy5faXRlcmF0ZWRPYmplY3Q7XG4gICAgICAgICAgY29uc3QgbGVuID0gdGhpcy5faXRlcmF0ZWRPYmplY3QubGVuZ3RoO1xuICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fbmV4dEluZGV4O1xuICAgICAgICAgIGNvbnN0IGtpbmQgPSB0aGlzLl9raW5kO1xuXG4gICAgICAgICAgaWYgKGluZGV4ID49IGxlbikge1xuICAgICAgICAgICAgdGhpcy5faXRlcmF0ZWRPYmplY3QgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlclJlc3VsdE9iamVjdCh1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuX25leHRJbmRleCA9IGluZGV4ICsgMTtcblxuICAgICAgICAgIGlmIChraW5kID09PSBLSU5EX0tFWSkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJSZXN1bHRPYmplY3QoaW5kZXgsIGZhbHNlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGtpbmQgPT09IEtJTkRfVkFMVUUpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KGFycmF5W2luZGV4XSwgZmFsc2UpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoa2luZCA9PT0gS0lORF9LRVlfVkFMKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlclJlc3VsdE9iamVjdChbaW5kZXgsIGFycmF5W2luZGV4XV0sIGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyAyMi4xLjUuMi4yICVBcnJheUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpXG4gICAgICAgICdAQGl0ZXJhdG9yJygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjbGFzcyBTdHJpbmdJdGVyYXRvciB7XG4gICAgICAgIC8vIDIxLjEuNS4xIENyZWF0ZVN0cmluZ0l0ZXJhdG9yIEFic3RyYWN0IE9wZXJhdGlvblxuICAgICAgICBjb25zdHJ1Y3RvcihzdHJpbmcpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdCBpcyBub3QgYSBzdHJpbmcnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5faXRlcmF0ZWRTdHJpbmcgPSBzdHJpbmc7XG4gICAgICAgICAgdGhpcy5fbmV4dEluZGV4ID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIDIxLjEuNS4yLjEgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KClcbiAgICAgICAgbmV4dCgpIHtcbiAgICAgICAgICBpZiAoIXRoaXMgaW5zdGFuY2VvZiBTdHJpbmdJdGVyYXRvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0IGlzIG5vdCBhIFN0cmluZ0l0ZXJhdG9yJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMuX2l0ZXJhdGVkU3RyaW5nID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9uZXh0SW5kZXg7XG4gICAgICAgICAgY29uc3QgcyA9IHRoaXMuX2l0ZXJhdGVkU3RyaW5nO1xuICAgICAgICAgIGNvbnN0IGxlbiA9IHMubGVuZ3RoO1xuXG4gICAgICAgICAgaWYgKGluZGV4ID49IGxlbikge1xuICAgICAgICAgICAgdGhpcy5faXRlcmF0ZWRTdHJpbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlclJlc3VsdE9iamVjdCh1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCByZXQ7XG4gICAgICAgICAgY29uc3QgZmlyc3QgPSBzLmNoYXJDb2RlQXQoaW5kZXgpO1xuXG4gICAgICAgICAgaWYgKGZpcnN0IDwgMHhkODAwIHx8IGZpcnN0ID4gMHhkYmZmIHx8IGluZGV4ICsgMSA9PT0gbGVuKSB7XG4gICAgICAgICAgICByZXQgPSBzW2luZGV4XTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc2Vjb25kID0gcy5jaGFyQ29kZUF0KGluZGV4ICsgMSk7XG4gICAgICAgICAgICBpZiAoc2Vjb25kIDwgMHhkYzAwIHx8IHNlY29uZCA+IDB4ZGZmZikge1xuICAgICAgICAgICAgICByZXQgPSBzW2luZGV4XTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldCA9IHNbaW5kZXhdICsgc1tpbmRleCArIDFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuX25leHRJbmRleCA9IGluZGV4ICsgcmV0Lmxlbmd0aDtcblxuICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KHJldCwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMjEuMS41LjIuMiAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlW0BASVRFUkFUT1JfU1lNQk9MXSgpXG4gICAgICAgICdAQGl0ZXJhdG9yJygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyA3LjQuNyBjcmVhdGVJdGVyUmVzdWx0T2JqZWN0KHZhbHVlLCBkb25lKVxuICAgICAgZnVuY3Rpb24gY3JlYXRlSXRlclJlc3VsdE9iamVjdCh2YWx1ZSwgZG9uZSkge1xuICAgICAgICByZXR1cm4ge3ZhbHVlOiB2YWx1ZSwgZG9uZTogZG9uZX07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QsIGtpbmQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYmplY3QgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdJdGVyYXRvcihvYmplY3QpO1xuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0KSkge1xuICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlJdGVyYXRvcihvYmplY3QsIGtpbmQgfHwgS0lORF9WQUxVRSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG9iamVjdFtJVEVSQVRPUl9TWU1CT0xdKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSkoKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0W0lURVJBVE9SX1NZTUJPTF0oKTtcbiAgICB9O1xuICB9XG59KSgpO1xuXG4vKipcbiAqIEV4cG9ydCBjb25zdGFudHNcbiAqL1xuXG5PYmplY3QuYXNzaWduKHRvSXRlcmF0b3IsIHtcbiAgS0lORF9LRVksXG4gIEtJTkRfVkFMVUUsXG4gIEtJTkRfS0VZX1ZBTCxcbiAgSVRFUkFUT1JfU1lNQk9MLFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gdG9JdGVyYXRvcjtcbiJdfQ==