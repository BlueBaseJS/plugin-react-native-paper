7451be1986f529ed92fae84531801adb
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var invariant = require('fbjs/lib/invariant');

var isEmpty = require('isEmpty');

var warning = require('fbjs/lib/warning');

function defaultGetRowData(dataBlob, sectionID, rowID) {
  return dataBlob[sectionID][rowID];
}

function defaultGetSectionHeaderData(dataBlob, sectionID) {
  return dataBlob[sectionID];
}

var ListViewDataSource = function () {
  function ListViewDataSource(params) {
    (0, _classCallCheck2.default)(this, ListViewDataSource);
    invariant(params && typeof params.rowHasChanged === 'function', 'Must provide a rowHasChanged function.');
    this._rowHasChanged = params.rowHasChanged;
    this._getRowData = params.getRowData || defaultGetRowData;
    this._sectionHeaderHasChanged = params.sectionHeaderHasChanged;
    this._getSectionHeaderData = params.getSectionHeaderData || defaultGetSectionHeaderData;
    this._dataBlob = null;
    this._dirtyRows = [];
    this._dirtySections = [];
    this._cachedRowCount = 0;
    this.rowIdentities = [];
    this.sectionIdentities = [];
  }

  (0, _createClass2.default)(ListViewDataSource, [{
    key: "cloneWithRows",
    value: function cloneWithRows(dataBlob, rowIdentities) {
      var rowIds = rowIdentities ? [(0, _toConsumableArray2.default)(rowIdentities)] : null;

      if (!this._sectionHeaderHasChanged) {
        this._sectionHeaderHasChanged = function () {
          return false;
        };
      }

      return this.cloneWithRowsAndSections({
        s1: dataBlob
      }, ['s1'], rowIds);
    }
  }, {
    key: "cloneWithRowsAndSections",
    value: function cloneWithRowsAndSections(dataBlob, sectionIdentities, rowIdentities) {
      invariant(typeof this._sectionHeaderHasChanged === 'function', 'Must provide a sectionHeaderHasChanged function with section data.');
      invariant(!sectionIdentities || !rowIdentities || sectionIdentities.length === rowIdentities.length, 'row and section ids lengths must be the same');
      var newSource = new ListViewDataSource({
        getRowData: this._getRowData,
        getSectionHeaderData: this._getSectionHeaderData,
        rowHasChanged: this._rowHasChanged,
        sectionHeaderHasChanged: this._sectionHeaderHasChanged
      });
      newSource._dataBlob = dataBlob;

      if (sectionIdentities) {
        newSource.sectionIdentities = sectionIdentities;
      } else {
        newSource.sectionIdentities = Object.keys(dataBlob);
      }

      if (rowIdentities) {
        newSource.rowIdentities = rowIdentities;
      } else {
        newSource.rowIdentities = [];
        newSource.sectionIdentities.forEach(function (sectionID) {
          newSource.rowIdentities.push(Object.keys(dataBlob[sectionID]));
        });
      }

      newSource._cachedRowCount = countRows(newSource.rowIdentities);

      newSource._calculateDirtyArrays(this._dataBlob, this.sectionIdentities, this.rowIdentities);

      return newSource;
    }
  }, {
    key: "getRowCount",
    value: function getRowCount() {
      return this._cachedRowCount;
    }
  }, {
    key: "getRowAndSectionCount",
    value: function getRowAndSectionCount() {
      return this._cachedRowCount + this.sectionIdentities.length;
    }
  }, {
    key: "rowShouldUpdate",
    value: function rowShouldUpdate(sectionIndex, rowIndex) {
      var needsUpdate = this._dirtyRows[sectionIndex][rowIndex];
      warning(needsUpdate !== undefined, 'missing dirtyBit for section, row: ' + sectionIndex + ', ' + rowIndex);
      return needsUpdate;
    }
  }, {
    key: "getRowData",
    value: function getRowData(sectionIndex, rowIndex) {
      var sectionID = this.sectionIdentities[sectionIndex];
      var rowID = this.rowIdentities[sectionIndex][rowIndex];
      warning(sectionID !== undefined && rowID !== undefined, 'rendering invalid section, row: ' + sectionIndex + ', ' + rowIndex);
      return this._getRowData(this._dataBlob, sectionID, rowID);
    }
  }, {
    key: "getRowIDForFlatIndex",
    value: function getRowIDForFlatIndex(index) {
      var accessIndex = index;

      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        if (accessIndex >= this.rowIdentities[ii].length) {
          accessIndex -= this.rowIdentities[ii].length;
        } else {
          return this.rowIdentities[ii][accessIndex];
        }
      }

      return null;
    }
  }, {
    key: "getSectionIDForFlatIndex",
    value: function getSectionIDForFlatIndex(index) {
      var accessIndex = index;

      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        if (accessIndex >= this.rowIdentities[ii].length) {
          accessIndex -= this.rowIdentities[ii].length;
        } else {
          return this.sectionIdentities[ii];
        }
      }

      return null;
    }
  }, {
    key: "getSectionLengths",
    value: function getSectionLengths() {
      var results = [];

      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        results.push(this.rowIdentities[ii].length);
      }

      return results;
    }
  }, {
    key: "sectionHeaderShouldUpdate",
    value: function sectionHeaderShouldUpdate(sectionIndex) {
      var needsUpdate = this._dirtySections[sectionIndex];
      warning(needsUpdate !== undefined, 'missing dirtyBit for section: ' + sectionIndex);
      return needsUpdate;
    }
  }, {
    key: "getSectionHeaderData",
    value: function getSectionHeaderData(sectionIndex) {
      if (!this._getSectionHeaderData) {
        return null;
      }

      var sectionID = this.sectionIdentities[sectionIndex];
      warning(sectionID !== undefined, 'renderSection called on invalid section: ' + sectionIndex);
      return this._getSectionHeaderData(this._dataBlob, sectionID);
    }
  }, {
    key: "_calculateDirtyArrays",
    value: function _calculateDirtyArrays(prevDataBlob, prevSectionIDs, prevRowIDs) {
      var prevSectionsHash = keyedDictionaryFromArray(prevSectionIDs);
      var prevRowsHash = {};

      for (var ii = 0; ii < prevRowIDs.length; ii++) {
        var sectionID = prevSectionIDs[ii];
        warning(!prevRowsHash[sectionID], 'SectionID appears more than once: ' + sectionID);
        prevRowsHash[sectionID] = keyedDictionaryFromArray(prevRowIDs[ii]);
      }

      this._dirtySections = [];
      this._dirtyRows = [];
      var dirty;

      for (var sIndex = 0; sIndex < this.sectionIdentities.length; sIndex++) {
        var sectionID = this.sectionIdentities[sIndex];
        dirty = !prevSectionsHash[sectionID];
        var sectionHeaderHasChanged = this._sectionHeaderHasChanged;

        if (!dirty && sectionHeaderHasChanged) {
          dirty = sectionHeaderHasChanged(this._getSectionHeaderData(prevDataBlob, sectionID), this._getSectionHeaderData(this._dataBlob, sectionID));
        }

        this._dirtySections.push(!!dirty);

        this._dirtyRows[sIndex] = [];

        for (var rIndex = 0; rIndex < this.rowIdentities[sIndex].length; rIndex++) {
          var rowID = this.rowIdentities[sIndex][rIndex];
          dirty = !prevSectionsHash[sectionID] || !prevRowsHash[sectionID][rowID] || this._rowHasChanged(this._getRowData(prevDataBlob, sectionID, rowID), this._getRowData(this._dataBlob, sectionID, rowID));

          this._dirtyRows[sIndex].push(!!dirty);
        }
      }
    }
  }]);
  return ListViewDataSource;
}();

function countRows(allRowIDs) {
  var totalRows = 0;

  for (var sectionIdx = 0; sectionIdx < allRowIDs.length; sectionIdx++) {
    var rowIDs = allRowIDs[sectionIdx];
    totalRows += rowIDs.length;
  }

  return totalRows;
}

function keyedDictionaryFromArray(arr) {
  if (isEmpty(arr)) {
    return {};
  }

  var result = {};

  for (var ii = 0; ii < arr.length; ii++) {
    var _key = arr[ii];
    warning(!result[_key], 'Value appears more than once in array: ' + _key);
    result[_key] = true;
  }

  return result;
}

module.exports = ListViewDataSource;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpc3RWaWV3RGF0YVNvdXJjZS5qcyJdLCJuYW1lcyI6WyJpbnZhcmlhbnQiLCJyZXF1aXJlIiwiaXNFbXB0eSIsIndhcm5pbmciLCJkZWZhdWx0R2V0Um93RGF0YSIsImRhdGFCbG9iIiwic2VjdGlvbklEIiwicm93SUQiLCJkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGEiLCJMaXN0Vmlld0RhdGFTb3VyY2UiLCJwYXJhbXMiLCJyb3dIYXNDaGFuZ2VkIiwiX3Jvd0hhc0NoYW5nZWQiLCJfZ2V0Um93RGF0YSIsImdldFJvd0RhdGEiLCJfc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQiLCJzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCIsIl9nZXRTZWN0aW9uSGVhZGVyRGF0YSIsImdldFNlY3Rpb25IZWFkZXJEYXRhIiwiX2RhdGFCbG9iIiwiX2RpcnR5Um93cyIsIl9kaXJ0eVNlY3Rpb25zIiwiX2NhY2hlZFJvd0NvdW50Iiwicm93SWRlbnRpdGllcyIsInNlY3Rpb25JZGVudGl0aWVzIiwicm93SWRzIiwiY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zIiwiczEiLCJsZW5ndGgiLCJuZXdTb3VyY2UiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInB1c2giLCJjb3VudFJvd3MiLCJfY2FsY3VsYXRlRGlydHlBcnJheXMiLCJzZWN0aW9uSW5kZXgiLCJyb3dJbmRleCIsIm5lZWRzVXBkYXRlIiwidW5kZWZpbmVkIiwiaW5kZXgiLCJhY2Nlc3NJbmRleCIsImlpIiwicmVzdWx0cyIsInByZXZEYXRhQmxvYiIsInByZXZTZWN0aW9uSURzIiwicHJldlJvd0lEcyIsInByZXZTZWN0aW9uc0hhc2giLCJrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkiLCJwcmV2Um93c0hhc2giLCJkaXJ0eSIsInNJbmRleCIsInJJbmRleCIsImFsbFJvd0lEcyIsInRvdGFsUm93cyIsInNlY3Rpb25JZHgiLCJyb3dJRHMiLCJhcnIiLCJyZXN1bHQiLCJrZXkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFTQTs7Ozs7Ozs7OztBQUVBLElBQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLG9CQUFELENBQXpCOztBQUNBLElBQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBSUEsSUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUMsa0JBQUQsQ0FBdkI7O0FBRUEsU0FBU0csaUJBQVQsQ0FDRUMsUUFERixFQUVFQyxTQUZGLEVBR0VDLEtBSEYsRUFJTztBQUNMLFNBQU9GLFFBQVEsQ0FBQ0MsU0FBRCxDQUFSLENBQW9CQyxLQUFwQixDQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsMkJBQVQsQ0FDRUgsUUFERixFQUVFQyxTQUZGLEVBR087QUFDTCxTQUFPRCxRQUFRLENBQUNDLFNBQUQsQ0FBZjtBQUNEOztJQTZDS0csa0I7QUEwQkosOEJBQVlDLE1BQVosRUFBK0I7QUFBQTtBQUM3QlYsSUFBQUEsU0FBUyxDQUNQVSxNQUFNLElBQUksT0FBT0EsTUFBTSxDQUFDQyxhQUFkLEtBQWdDLFVBRG5DLEVBRVAsd0NBRk8sQ0FBVDtBQUlBLFNBQUtDLGNBQUwsR0FBc0JGLE1BQU0sQ0FBQ0MsYUFBN0I7QUFDQSxTQUFLRSxXQUFMLEdBQW1CSCxNQUFNLENBQUNJLFVBQVAsSUFBcUJWLGlCQUF4QztBQUNBLFNBQUtXLHdCQUFMLEdBQWdDTCxNQUFNLENBQUNNLHVCQUF2QztBQUNBLFNBQUtDLHFCQUFMLEdBQ0VQLE1BQU0sQ0FBQ1Esb0JBQVAsSUFBK0JWLDJCQURqQztBQUdBLFNBQUtXLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLQyxVQUFMLEdBQWtCLEVBQWxCO0FBQ0EsU0FBS0MsY0FBTCxHQUFzQixFQUF0QjtBQUNBLFNBQUtDLGVBQUwsR0FBdUIsQ0FBdkI7QUFJQSxTQUFLQyxhQUFMLEdBQXFCLEVBQXJCO0FBQ0EsU0FBS0MsaUJBQUwsR0FBeUIsRUFBekI7QUFDRDs7OztrQ0FtQkNuQixRLEVBQ0FrQixhLEVBQ29CO0FBQ3BCLFVBQU1FLE1BQU0sR0FBR0YsYUFBYSxHQUFHLGtDQUFLQSxhQUFMLEVBQUgsR0FBMEIsSUFBdEQ7O0FBQ0EsVUFBSSxDQUFDLEtBQUtSLHdCQUFWLEVBQW9DO0FBQ2xDLGFBQUtBLHdCQUFMLEdBQWdDO0FBQUEsaUJBQU0sS0FBTjtBQUFBLFNBQWhDO0FBQ0Q7O0FBQ0QsYUFBTyxLQUFLVyx3QkFBTCxDQUE4QjtBQUFDQyxRQUFBQSxFQUFFLEVBQUV0QjtBQUFMLE9BQTlCLEVBQThDLENBQUMsSUFBRCxDQUE5QyxFQUFzRG9CLE1BQXRELENBQVA7QUFDRDs7OzZDQXNCQ3BCLFEsRUFDQW1CLGlCLEVBQ0FELGEsRUFDb0I7QUFDcEJ2QixNQUFBQSxTQUFTLENBQ1AsT0FBTyxLQUFLZSx3QkFBWixLQUF5QyxVQURsQyxFQUVQLG9FQUZPLENBQVQ7QUFJQWYsTUFBQUEsU0FBUyxDQUNQLENBQUN3QixpQkFBRCxJQUNFLENBQUNELGFBREgsSUFFRUMsaUJBQWlCLENBQUNJLE1BQWxCLEtBQTZCTCxhQUFhLENBQUNLLE1BSHRDLEVBSVAsOENBSk8sQ0FBVDtBQU9BLFVBQU1DLFNBQVMsR0FBRyxJQUFJcEIsa0JBQUosQ0FBdUI7QUFDdkNLLFFBQUFBLFVBQVUsRUFBRSxLQUFLRCxXQURzQjtBQUV2Q0ssUUFBQUEsb0JBQW9CLEVBQUUsS0FBS0QscUJBRlk7QUFHdkNOLFFBQUFBLGFBQWEsRUFBRSxLQUFLQyxjQUhtQjtBQUl2Q0ksUUFBQUEsdUJBQXVCLEVBQUUsS0FBS0Q7QUFKUyxPQUF2QixDQUFsQjtBQU1BYyxNQUFBQSxTQUFTLENBQUNWLFNBQVYsR0FBc0JkLFFBQXRCOztBQUNBLFVBQUltQixpQkFBSixFQUF1QjtBQUNyQkssUUFBQUEsU0FBUyxDQUFDTCxpQkFBVixHQUE4QkEsaUJBQTlCO0FBQ0QsT0FGRCxNQUVPO0FBQ0xLLFFBQUFBLFNBQVMsQ0FBQ0wsaUJBQVYsR0FBOEJNLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZMUIsUUFBWixDQUE5QjtBQUNEOztBQUNELFVBQUlrQixhQUFKLEVBQW1CO0FBQ2pCTSxRQUFBQSxTQUFTLENBQUNOLGFBQVYsR0FBMEJBLGFBQTFCO0FBQ0QsT0FGRCxNQUVPO0FBQ0xNLFFBQUFBLFNBQVMsQ0FBQ04sYUFBVixHQUEwQixFQUExQjtBQUNBTSxRQUFBQSxTQUFTLENBQUNMLGlCQUFWLENBQTRCUSxPQUE1QixDQUFvQyxVQUFBMUIsU0FBUyxFQUFJO0FBQy9DdUIsVUFBQUEsU0FBUyxDQUFDTixhQUFWLENBQXdCVSxJQUF4QixDQUE2QkgsTUFBTSxDQUFDQyxJQUFQLENBQVkxQixRQUFRLENBQUNDLFNBQUQsQ0FBcEIsQ0FBN0I7QUFDRCxTQUZEO0FBR0Q7O0FBQ0R1QixNQUFBQSxTQUFTLENBQUNQLGVBQVYsR0FBNEJZLFNBQVMsQ0FBQ0wsU0FBUyxDQUFDTixhQUFYLENBQXJDOztBQUVBTSxNQUFBQSxTQUFTLENBQUNNLHFCQUFWLENBQ0UsS0FBS2hCLFNBRFAsRUFFRSxLQUFLSyxpQkFGUCxFQUdFLEtBQUtELGFBSFA7O0FBTUEsYUFBT00sU0FBUDtBQUNEOzs7a0NBT3FCO0FBQ3BCLGFBQU8sS0FBS1AsZUFBWjtBQUNEOzs7NENBTytCO0FBQzlCLGFBQU8sS0FBS0EsZUFBTCxHQUF1QixLQUFLRSxpQkFBTCxDQUF1QkksTUFBckQ7QUFDRDs7O29DQUtlUSxZLEVBQXNCQyxRLEVBQTJCO0FBQy9ELFVBQU1DLFdBQVcsR0FBRyxLQUFLbEIsVUFBTCxDQUFnQmdCLFlBQWhCLEVBQThCQyxRQUE5QixDQUFwQjtBQUNBbEMsTUFBQUEsT0FBTyxDQUNMbUMsV0FBVyxLQUFLQyxTQURYLEVBRUwsd0NBQXdDSCxZQUF4QyxHQUF1RCxJQUF2RCxHQUE4REMsUUFGekQsQ0FBUDtBQUlBLGFBQU9DLFdBQVA7QUFDRDs7OytCQUtVRixZLEVBQXNCQyxRLEVBQXVCO0FBQ3RELFVBQU0vQixTQUFTLEdBQUcsS0FBS2tCLGlCQUFMLENBQXVCWSxZQUF2QixDQUFsQjtBQUNBLFVBQU03QixLQUFLLEdBQUcsS0FBS2dCLGFBQUwsQ0FBbUJhLFlBQW5CLEVBQWlDQyxRQUFqQyxDQUFkO0FBQ0FsQyxNQUFBQSxPQUFPLENBQ0xHLFNBQVMsS0FBS2lDLFNBQWQsSUFBMkJoQyxLQUFLLEtBQUtnQyxTQURoQyxFQUVMLHFDQUFxQ0gsWUFBckMsR0FBb0QsSUFBcEQsR0FBMkRDLFFBRnRELENBQVA7QUFJQSxhQUFPLEtBQUt4QixXQUFMLENBQWlCLEtBQUtNLFNBQXRCLEVBQWlDYixTQUFqQyxFQUE0Q0MsS0FBNUMsQ0FBUDtBQUNEOzs7eUNBTW9CaUMsSyxFQUF3QjtBQUMzQyxVQUFJQyxXQUFXLEdBQUdELEtBQWxCOztBQUNBLFdBQUssSUFBSUUsRUFBRSxHQUFHLENBQWQsRUFBaUJBLEVBQUUsR0FBRyxLQUFLbEIsaUJBQUwsQ0FBdUJJLE1BQTdDLEVBQXFEYyxFQUFFLEVBQXZELEVBQTJEO0FBQ3pELFlBQUlELFdBQVcsSUFBSSxLQUFLbEIsYUFBTCxDQUFtQm1CLEVBQW5CLEVBQXVCZCxNQUExQyxFQUFrRDtBQUNoRGEsVUFBQUEsV0FBVyxJQUFJLEtBQUtsQixhQUFMLENBQW1CbUIsRUFBbkIsRUFBdUJkLE1BQXRDO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsaUJBQU8sS0FBS0wsYUFBTCxDQUFtQm1CLEVBQW5CLEVBQXVCRCxXQUF2QixDQUFQO0FBQ0Q7QUFDRjs7QUFDRCxhQUFPLElBQVA7QUFDRDs7OzZDQU13QkQsSyxFQUF3QjtBQUMvQyxVQUFJQyxXQUFXLEdBQUdELEtBQWxCOztBQUNBLFdBQUssSUFBSUUsRUFBRSxHQUFHLENBQWQsRUFBaUJBLEVBQUUsR0FBRyxLQUFLbEIsaUJBQUwsQ0FBdUJJLE1BQTdDLEVBQXFEYyxFQUFFLEVBQXZELEVBQTJEO0FBQ3pELFlBQUlELFdBQVcsSUFBSSxLQUFLbEIsYUFBTCxDQUFtQm1CLEVBQW5CLEVBQXVCZCxNQUExQyxFQUFrRDtBQUNoRGEsVUFBQUEsV0FBVyxJQUFJLEtBQUtsQixhQUFMLENBQW1CbUIsRUFBbkIsRUFBdUJkLE1BQXRDO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsaUJBQU8sS0FBS0osaUJBQUwsQ0FBdUJrQixFQUF2QixDQUFQO0FBQ0Q7QUFDRjs7QUFDRCxhQUFPLElBQVA7QUFDRDs7O3dDQUtrQztBQUNqQyxVQUFNQyxPQUFPLEdBQUcsRUFBaEI7O0FBQ0EsV0FBSyxJQUFJRCxFQUFFLEdBQUcsQ0FBZCxFQUFpQkEsRUFBRSxHQUFHLEtBQUtsQixpQkFBTCxDQUF1QkksTUFBN0MsRUFBcURjLEVBQUUsRUFBdkQsRUFBMkQ7QUFDekRDLFFBQUFBLE9BQU8sQ0FBQ1YsSUFBUixDQUFhLEtBQUtWLGFBQUwsQ0FBbUJtQixFQUFuQixFQUF1QmQsTUFBcEM7QUFDRDs7QUFDRCxhQUFPZSxPQUFQO0FBQ0Q7Ozs4Q0FLeUJQLFksRUFBK0I7QUFDdkQsVUFBTUUsV0FBVyxHQUFHLEtBQUtqQixjQUFMLENBQW9CZSxZQUFwQixDQUFwQjtBQUNBakMsTUFBQUEsT0FBTyxDQUNMbUMsV0FBVyxLQUFLQyxTQURYLEVBRUwsbUNBQW1DSCxZQUY5QixDQUFQO0FBSUEsYUFBT0UsV0FBUDtBQUNEOzs7eUNBS29CRixZLEVBQTJCO0FBQzlDLFVBQUksQ0FBQyxLQUFLbkIscUJBQVYsRUFBaUM7QUFDL0IsZUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsVUFBTVgsU0FBUyxHQUFHLEtBQUtrQixpQkFBTCxDQUF1QlksWUFBdkIsQ0FBbEI7QUFDQWpDLE1BQUFBLE9BQU8sQ0FDTEcsU0FBUyxLQUFLaUMsU0FEVCxFQUVMLDhDQUE4Q0gsWUFGekMsQ0FBUDtBQUlBLGFBQU8sS0FBS25CLHFCQUFMLENBQTJCLEtBQUtFLFNBQWhDLEVBQTJDYixTQUEzQyxDQUFQO0FBQ0Q7OzswQ0FzQkNzQyxZLEVBQ0FDLGMsRUFDQUMsVSxFQUNNO0FBRU4sVUFBTUMsZ0JBQWdCLEdBQUdDLHdCQUF3QixDQUFDSCxjQUFELENBQWpEO0FBQ0EsVUFBTUksWUFBWSxHQUFHLEVBQXJCOztBQUNBLFdBQUssSUFBSVAsRUFBRSxHQUFHLENBQWQsRUFBaUJBLEVBQUUsR0FBR0ksVUFBVSxDQUFDbEIsTUFBakMsRUFBeUNjLEVBQUUsRUFBM0MsRUFBK0M7QUFDN0MsWUFBSXBDLFNBQVMsR0FBR3VDLGNBQWMsQ0FBQ0gsRUFBRCxDQUE5QjtBQUNBdkMsUUFBQUEsT0FBTyxDQUNMLENBQUM4QyxZQUFZLENBQUMzQyxTQUFELENBRFIsRUFFTCx1Q0FBdUNBLFNBRmxDLENBQVA7QUFJQTJDLFFBQUFBLFlBQVksQ0FBQzNDLFNBQUQsQ0FBWixHQUEwQjBDLHdCQUF3QixDQUFDRixVQUFVLENBQUNKLEVBQUQsQ0FBWCxDQUFsRDtBQUNEOztBQUdELFdBQUtyQixjQUFMLEdBQXNCLEVBQXRCO0FBQ0EsV0FBS0QsVUFBTCxHQUFrQixFQUFsQjtBQUVBLFVBQUk4QixLQUFKOztBQUNBLFdBQUssSUFBSUMsTUFBTSxHQUFHLENBQWxCLEVBQXFCQSxNQUFNLEdBQUcsS0FBSzNCLGlCQUFMLENBQXVCSSxNQUFyRCxFQUE2RHVCLE1BQU0sRUFBbkUsRUFBdUU7QUFDckUsWUFBSTdDLFNBQVMsR0FBRyxLQUFLa0IsaUJBQUwsQ0FBdUIyQixNQUF2QixDQUFoQjtBQUVBRCxRQUFBQSxLQUFLLEdBQUcsQ0FBQ0gsZ0JBQWdCLENBQUN6QyxTQUFELENBQXpCO0FBQ0EsWUFBTVUsdUJBQXVCLEdBQUcsS0FBS0Qsd0JBQXJDOztBQUNBLFlBQUksQ0FBQ21DLEtBQUQsSUFBVWxDLHVCQUFkLEVBQXVDO0FBQ3JDa0MsVUFBQUEsS0FBSyxHQUFHbEMsdUJBQXVCLENBQzdCLEtBQUtDLHFCQUFMLENBQTJCMkIsWUFBM0IsRUFBeUN0QyxTQUF6QyxDQUQ2QixFQUU3QixLQUFLVyxxQkFBTCxDQUEyQixLQUFLRSxTQUFoQyxFQUEyQ2IsU0FBM0MsQ0FGNkIsQ0FBL0I7QUFJRDs7QUFDRCxhQUFLZSxjQUFMLENBQW9CWSxJQUFwQixDQUF5QixDQUFDLENBQUNpQixLQUEzQjs7QUFFQSxhQUFLOUIsVUFBTCxDQUFnQitCLE1BQWhCLElBQTBCLEVBQTFCOztBQUNBLGFBQ0UsSUFBSUMsTUFBTSxHQUFHLENBRGYsRUFFRUEsTUFBTSxHQUFHLEtBQUs3QixhQUFMLENBQW1CNEIsTUFBbkIsRUFBMkJ2QixNQUZ0QyxFQUdFd0IsTUFBTSxFQUhSLEVBSUU7QUFDQSxjQUFNN0MsS0FBSyxHQUFHLEtBQUtnQixhQUFMLENBQW1CNEIsTUFBbkIsRUFBMkJDLE1BQTNCLENBQWQ7QUFFQUYsVUFBQUEsS0FBSyxHQUNILENBQUNILGdCQUFnQixDQUFDekMsU0FBRCxDQUFqQixJQUNBLENBQUMyQyxZQUFZLENBQUMzQyxTQUFELENBQVosQ0FBd0JDLEtBQXhCLENBREQsSUFFQSxLQUFLSyxjQUFMLENBQ0UsS0FBS0MsV0FBTCxDQUFpQitCLFlBQWpCLEVBQStCdEMsU0FBL0IsRUFBMENDLEtBQTFDLENBREYsRUFFRSxLQUFLTSxXQUFMLENBQWlCLEtBQUtNLFNBQXRCLEVBQWlDYixTQUFqQyxFQUE0Q0MsS0FBNUMsQ0FGRixDQUhGOztBQU9BLGVBQUthLFVBQUwsQ0FBZ0IrQixNQUFoQixFQUF3QmxCLElBQXhCLENBQTZCLENBQUMsQ0FBQ2lCLEtBQS9CO0FBQ0Q7QUFDRjtBQUNGOzs7OztBQUdILFNBQVNoQixTQUFULENBQW1CbUIsU0FBbkIsRUFBOEI7QUFDNUIsTUFBSUMsU0FBUyxHQUFHLENBQWhCOztBQUNBLE9BQUssSUFBSUMsVUFBVSxHQUFHLENBQXRCLEVBQXlCQSxVQUFVLEdBQUdGLFNBQVMsQ0FBQ3pCLE1BQWhELEVBQXdEMkIsVUFBVSxFQUFsRSxFQUFzRTtBQUNwRSxRQUFNQyxNQUFNLEdBQUdILFNBQVMsQ0FBQ0UsVUFBRCxDQUF4QjtBQUNBRCxJQUFBQSxTQUFTLElBQUlFLE1BQU0sQ0FBQzVCLE1BQXBCO0FBQ0Q7O0FBQ0QsU0FBTzBCLFNBQVA7QUFDRDs7QUFFRCxTQUFTTix3QkFBVCxDQUFrQ1MsR0FBbEMsRUFBdUM7QUFDckMsTUFBSXZELE9BQU8sQ0FBQ3VELEdBQUQsQ0FBWCxFQUFrQjtBQUNoQixXQUFPLEVBQVA7QUFDRDs7QUFDRCxNQUFNQyxNQUFNLEdBQUcsRUFBZjs7QUFDQSxPQUFLLElBQUloQixFQUFFLEdBQUcsQ0FBZCxFQUFpQkEsRUFBRSxHQUFHZSxHQUFHLENBQUM3QixNQUExQixFQUFrQ2MsRUFBRSxFQUFwQyxFQUF3QztBQUN0QyxRQUFNaUIsSUFBRyxHQUFHRixHQUFHLENBQUNmLEVBQUQsQ0FBZjtBQUNBdkMsSUFBQUEsT0FBTyxDQUFDLENBQUN1RCxNQUFNLENBQUNDLElBQUQsQ0FBUixFQUFlLDRDQUE0Q0EsSUFBM0QsQ0FBUDtBQUNBRCxJQUFBQSxNQUFNLENBQUNDLElBQUQsQ0FBTixHQUFjLElBQWQ7QUFDRDs7QUFDRCxTQUFPRCxNQUFQO0FBQ0Q7O0FBRURFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnBELGtCQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcbmNvbnN0IGlzRW1wdHkgPSByZXF1aXJlKCdpc0VtcHR5Jyk7XG4vKiAkRmxvd0ZpeE1lKD49MC41NC4wIHNpdGU9cmVhY3RfbmF0aXZlX29zcykgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW4gZXJyb3JcbiAqIGZvdW5kIHdoZW4gRmxvdyB2MC41NCB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IgZGVsZXRlIHRoaXMgY29tbWVudCBhbmRcbiAqIHJ1biBGbG93LiAqL1xuY29uc3Qgd2FybmluZyA9IHJlcXVpcmUoJ2ZianMvbGliL3dhcm5pbmcnKTtcblxuZnVuY3Rpb24gZGVmYXVsdEdldFJvd0RhdGEoXG4gIGRhdGFCbG9iOiBhbnksXG4gIHNlY3Rpb25JRDogbnVtYmVyIHwgc3RyaW5nLFxuICByb3dJRDogbnVtYmVyIHwgc3RyaW5nLFxuKTogYW55IHtcbiAgcmV0dXJuIGRhdGFCbG9iW3NlY3Rpb25JRF1bcm93SURdO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGEoXG4gIGRhdGFCbG9iOiBhbnksXG4gIHNlY3Rpb25JRDogbnVtYmVyIHwgc3RyaW5nLFxuKTogYW55IHtcbiAgcmV0dXJuIGRhdGFCbG9iW3NlY3Rpb25JRF07XG59XG5cbnR5cGUgZGlmZmVyVHlwZSA9IChkYXRhMTogYW55LCBkYXRhMjogYW55KSA9PiBib29sZWFuO1xuXG50eXBlIFBhcmFtVHlwZSA9IHtcbiAgcm93SGFzQ2hhbmdlZDogZGlmZmVyVHlwZSxcbiAgZ2V0Um93RGF0YT86ID90eXBlb2YgZGVmYXVsdEdldFJvd0RhdGEsXG4gIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkPzogP2RpZmZlclR5cGUsXG4gIGdldFNlY3Rpb25IZWFkZXJEYXRhPzogP3R5cGVvZiBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGEsXG59O1xuXG4vKipcbiAqIFByb3ZpZGVzIGVmZmljaWVudCBkYXRhIHByb2Nlc3NpbmcgYW5kIGFjY2VzcyB0byB0aGVcbiAqIGBMaXN0Vmlld2AgY29tcG9uZW50LiAgQSBgTGlzdFZpZXdEYXRhU291cmNlYCBpcyBjcmVhdGVkIHdpdGggZnVuY3Rpb25zIGZvclxuICogZXh0cmFjdGluZyBkYXRhIGZyb20gdGhlIGlucHV0IGJsb2IsIGFuZCBjb21wYXJpbmcgZWxlbWVudHMgKHdpdGggZGVmYXVsdFxuICogaW1wbGVtZW50YXRpb25zIGZvciBjb252ZW5pZW5jZSkuICBUaGUgaW5wdXQgYmxvYiBjYW4gYmUgYXMgc2ltcGxlIGFzIGFuXG4gKiBhcnJheSBvZiBzdHJpbmdzLCBvciBhbiBvYmplY3Qgd2l0aCByb3dzIG5lc3RlZCBpbnNpZGUgc2VjdGlvbiBvYmplY3RzLlxuICpcbiAqIFRvIHVwZGF0ZSB0aGUgZGF0YSBpbiB0aGUgZGF0YXNvdXJjZSwgdXNlIGBjbG9uZVdpdGhSb3dzYCAob3JcbiAqIGBjbG9uZVdpdGhSb3dzQW5kU2VjdGlvbnNgIGlmIHlvdSBjYXJlIGFib3V0IHNlY3Rpb25zKS4gIFRoZSBkYXRhIGluIHRoZVxuICogZGF0YSBzb3VyY2UgaXMgaW1tdXRhYmxlLCBzbyB5b3UgY2FuJ3QgbW9kaWZ5IGl0IGRpcmVjdGx5LiAgVGhlIGNsb25lIG1ldGhvZHNcbiAqIHN1Y2sgaW4gdGhlIG5ldyBkYXRhIGFuZCBjb21wdXRlIGEgZGlmZiBmb3IgZWFjaCByb3cgc28gTGlzdFZpZXcga25vd3NcbiAqIHdoZXRoZXIgdG8gcmUtcmVuZGVyIGl0IG9yIG5vdC5cbiAqXG4gKiBJbiB0aGlzIGV4YW1wbGUsIGEgY29tcG9uZW50IHJlY2VpdmVzIGRhdGEgaW4gY2h1bmtzLCBoYW5kbGVkIGJ5XG4gKiBgX29uRGF0YUFycml2ZWRgLCB3aGljaCBjb25jYXRzIHRoZSBuZXcgZGF0YSBvbnRvIHRoZSBvbGQgZGF0YSBhbmQgdXBkYXRlcyB0aGVcbiAqIGRhdGEgc291cmNlLiAgV2UgdXNlIGBjb25jYXRgIHRvIGNyZWF0ZSBhIG5ldyBhcnJheSAtIG11dGF0aW5nIGB0aGlzLl9kYXRhYCxcbiAqIGUuZy4gd2l0aCBgdGhpcy5fZGF0YS5wdXNoKG5ld1Jvd0RhdGEpYCwgd291bGQgYmUgYW4gZXJyb3IuIGBfcm93SGFzQ2hhbmdlZGBcbiAqIHVuZGVyc3RhbmRzIHRoZSBzaGFwZSBvZiB0aGUgcm93IGRhdGEgYW5kIGtub3dzIGhvdyB0byBlZmZpY2llbnRseSBjb21wYXJlXG4gKiBpdC5cbiAqXG4gKiBgYGBcbiAqIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gKiAgIHZhciBkcyA9IG5ldyBMaXN0Vmlldy5EYXRhU291cmNlKHtyb3dIYXNDaGFuZ2VkOiB0aGlzLl9yb3dIYXNDaGFuZ2VkfSk7XG4gKiAgIHJldHVybiB7ZHN9O1xuICogfSxcbiAqIF9vbkRhdGFBcnJpdmVkKG5ld0RhdGEpIHtcbiAqICAgdGhpcy5fZGF0YSA9IHRoaXMuX2RhdGEuY29uY2F0KG5ld0RhdGEpO1xuICogICB0aGlzLnNldFN0YXRlKHtcbiAqICAgICBkczogdGhpcy5zdGF0ZS5kcy5jbG9uZVdpdGhSb3dzKHRoaXMuX2RhdGEpXG4gKiAgIH0pO1xuICogfVxuICogYGBgXG4gKi9cblxuY2xhc3MgTGlzdFZpZXdEYXRhU291cmNlIHtcbiAgLyoqXG4gICAqIFlvdSBjYW4gcHJvdmlkZSBjdXN0b20gZXh0cmFjdGlvbiBhbmQgYGhhc0NoYW5nZWRgIGZ1bmN0aW9ucyBmb3Igc2VjdGlvblxuICAgKiBoZWFkZXJzIGFuZCByb3dzLiAgSWYgYWJzZW50LCBkYXRhIHdpbGwgYmUgZXh0cmFjdGVkIHdpdGggdGhlXG4gICAqIGBkZWZhdWx0R2V0Um93RGF0YWAgYW5kIGBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGFgIGZ1bmN0aW9ucy5cbiAgICpcbiAgICogVGhlIGRlZmF1bHQgZXh0cmFjdG9yIGV4cGVjdHMgZGF0YSBvZiBvbmUgb2YgdGhlIGZvbGxvd2luZyBmb3JtczpcbiAgICpcbiAgICogICAgICB7IHNlY3Rpb25JRF8xOiB7IHJvd0lEXzE6IDxyb3dEYXRhMT4sIC4uLiB9LCAuLi4gfVxuICAgKlxuICAgKiAgICBvclxuICAgKlxuICAgKiAgICAgIHsgc2VjdGlvbklEXzE6IFsgPHJvd0RhdGExPiwgPHJvd0RhdGEyPiwgLi4uIF0sIC4uLiB9XG4gICAqXG4gICAqICAgIG9yXG4gICAqXG4gICAqICAgICAgWyBbIDxyb3dEYXRhMT4sIDxyb3dEYXRhMj4sIC4uLiBdLCAuLi4gXVxuICAgKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgaW4gYSBwYXJhbXMgYXJndW1lbnQgdGhhdCBjYW4gY29udGFpbiBhbnkgb2YgdGhlXG4gICAqIGZvbGxvd2luZzpcbiAgICpcbiAgICogLSBnZXRSb3dEYXRhKGRhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKTtcbiAgICogLSBnZXRTZWN0aW9uSGVhZGVyRGF0YShkYXRhQmxvYiwgc2VjdGlvbklEKTtcbiAgICogLSByb3dIYXNDaGFuZ2VkKHByZXZSb3dEYXRhLCBuZXh0Um93RGF0YSk7XG4gICAqIC0gc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQocHJldlNlY3Rpb25EYXRhLCBuZXh0U2VjdGlvbkRhdGEpO1xuICAgKi9cbiAgY29uc3RydWN0b3IocGFyYW1zOiBQYXJhbVR5cGUpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcy5yb3dIYXNDaGFuZ2VkID09PSAnZnVuY3Rpb24nLFxuICAgICAgJ011c3QgcHJvdmlkZSBhIHJvd0hhc0NoYW5nZWQgZnVuY3Rpb24uJyxcbiAgICApO1xuICAgIHRoaXMuX3Jvd0hhc0NoYW5nZWQgPSBwYXJhbXMucm93SGFzQ2hhbmdlZDtcbiAgICB0aGlzLl9nZXRSb3dEYXRhID0gcGFyYW1zLmdldFJvd0RhdGEgfHwgZGVmYXVsdEdldFJvd0RhdGE7XG4gICAgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSBwYXJhbXMuc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ7XG4gICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEgPVxuICAgICAgcGFyYW1zLmdldFNlY3Rpb25IZWFkZXJEYXRhIHx8IGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YTtcblxuICAgIHRoaXMuX2RhdGFCbG9iID0gbnVsbDtcbiAgICB0aGlzLl9kaXJ0eVJvd3MgPSBbXTtcbiAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zID0gW107XG4gICAgdGhpcy5fY2FjaGVkUm93Q291bnQgPSAwO1xuXG4gICAgLy8gVGhlc2UgdHdvIHByaXZhdGUgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCBieSBvdXRzaWRlcnMgYmVjYXVzZSBMaXN0Vmlld1xuICAgIC8vIHVzZXMgdGhlbSB0byBpdGVyYXRlIG92ZXIgdGhlIGRhdGEgaW4gdGhpcyBjbGFzcy5cbiAgICB0aGlzLnJvd0lkZW50aXRpZXMgPSBbXTtcbiAgICB0aGlzLnNlY3Rpb25JZGVudGl0aWVzID0gW107XG4gIH1cblxuICAvKipcbiAgICogQ2xvbmVzIHRoaXMgYExpc3RWaWV3RGF0YVNvdXJjZWAgd2l0aCB0aGUgc3BlY2lmaWVkIGBkYXRhQmxvYmAgYW5kXG4gICAqIGByb3dJZGVudGl0aWVzYC4gVGhlIGBkYXRhQmxvYmAgaXMganVzdCBhbiBhcmJpdHJhcnkgYmxvYiBvZiBkYXRhLiBBdFxuICAgKiBjb25zdHJ1Y3Rpb24gYW4gZXh0cmFjdG9yIHRvIGdldCB0aGUgaW50ZXJlc3RpbmcgaW5mb3JtYXRpb24gd2FzIGRlZmluZWRcbiAgICogKG9yIHRoZSBkZWZhdWx0IHdhcyB1c2VkKS5cbiAgICpcbiAgICogVGhlIGByb3dJZGVudGl0aWVzYCBpcyBhIDJEIGFycmF5IG9mIGlkZW50aWZpZXJzIGZvciByb3dzLlxuICAgKiBpZS4gW1snYTEnLCAnYTInXSwgWydiMScsICdiMicsICdiMyddLCAuLi5dLiAgSWYgbm90IHByb3ZpZGVkLCBpdCdzXG4gICAqIGFzc3VtZWQgdGhhdCB0aGUga2V5cyBvZiB0aGUgc2VjdGlvbiBkYXRhIGFyZSB0aGUgcm93IGlkZW50aXRpZXMuXG4gICAqXG4gICAqIE5vdGU6IFRoaXMgZnVuY3Rpb24gZG9lcyBOT1QgY2xvbmUgdGhlIGRhdGEgaW4gdGhpcyBkYXRhIHNvdXJjZS4gSXQgc2ltcGx5XG4gICAqIHBhc3NlcyB0aGUgZnVuY3Rpb25zIGRlZmluZWQgYXQgY29uc3RydWN0aW9uIHRvIGEgbmV3IGRhdGEgc291cmNlIHdpdGhcbiAgICogdGhlIGRhdGEgc3BlY2lmaWVkLiBJZiB5b3Ugd2lzaCB0byBtYWludGFpbiB0aGUgZXhpc3RpbmcgZGF0YSB5b3UgbXVzdFxuICAgKiBoYW5kbGUgbWVyZ2luZyBvZiBvbGQgYW5kIG5ldyBkYXRhIHNlcGFyYXRlbHkgYW5kIHRoZW4gcGFzcyB0aGF0IGludG9cbiAgICogdGhpcyBmdW5jdGlvbiBhcyB0aGUgYGRhdGFCbG9iYC5cbiAgICovXG4gIGNsb25lV2l0aFJvd3MoXG4gICAgZGF0YUJsb2I6ICRSZWFkT25seUFycmF5PGFueT4gfCB7K1trZXk6IHN0cmluZ106IGFueX0sXG4gICAgcm93SWRlbnRpdGllczogPyRSZWFkT25seUFycmF5PHN0cmluZz4sXG4gICk6IExpc3RWaWV3RGF0YVNvdXJjZSB7XG4gICAgY29uc3Qgcm93SWRzID0gcm93SWRlbnRpdGllcyA/IFtbLi4ucm93SWRlbnRpdGllc11dIDogbnVsbDtcbiAgICBpZiAoIXRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKSB7XG4gICAgICB0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCA9ICgpID0+IGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jbG9uZVdpdGhSb3dzQW5kU2VjdGlvbnMoe3MxOiBkYXRhQmxvYn0sIFsnczEnXSwgcm93SWRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIHBlcmZvcm1zIHRoZSBzYW1lIGZ1bmN0aW9uIGFzIHRoZSBgY2xvbmVXaXRoUm93c2AgZnVuY3Rpb24gYnV0IGhlcmVcbiAgICogeW91IGFsc28gc3BlY2lmeSB3aGF0IHlvdXIgYHNlY3Rpb25JZGVudGl0aWVzYCBhcmUuIElmIHlvdSBkb24ndCBjYXJlXG4gICAqIGFib3V0IHNlY3Rpb25zIHlvdSBzaG91bGQgc2FmZWx5IGJlIGFibGUgdG8gdXNlIGBjbG9uZVdpdGhSb3dzYC5cbiAgICpcbiAgICogYHNlY3Rpb25JZGVudGl0aWVzYCBpcyBhbiBhcnJheSBvZiBpZGVudGlmaWVycyBmb3Igc2VjdGlvbnMuXG4gICAqIGllLiBbJ3MxJywgJ3MyJywgLi4uXS4gIFRoZSBpZGVudGlmaWVycyBzaG91bGQgY29ycmVzcG9uZCB0byB0aGUga2V5cyBvciBhcnJheSBpbmRleGVzXG4gICAqIG9mIHRoZSBkYXRhIHlvdSB3aXNoIHRvIGluY2x1ZGUuICBJZiBub3QgcHJvdmlkZWQsIGl0J3MgYXNzdW1lZCB0aGF0IHRoZVxuICAgKiBrZXlzIG9mIGRhdGFCbG9iIGFyZSB0aGUgc2VjdGlvbiBpZGVudGl0aWVzLlxuICAgKlxuICAgKiBOb3RlOiB0aGlzIHJldHVybnMgYSBuZXcgb2JqZWN0IVxuICAgKlxuICAgKiBgYGBcbiAgICogY29uc3QgZGF0YVNvdXJjZSA9IGRzLmNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyh7XG4gICAqICAgYWRkcmVzc2VzOiBbJ3JvdyAxJywgJ3JvdyAyJ10sXG4gICAqICAgcGhvbmVfbnVtYmVyczogWydkYXRhIDEnLCAnZGF0YSAyJ10sXG4gICAqIH0sIFsncGhvbmVfbnVtYmVycyddKTtcbiAgICogYGBgXG4gICAqL1xuICBjbG9uZVdpdGhSb3dzQW5kU2VjdGlvbnMoXG4gICAgZGF0YUJsb2I6IGFueSxcbiAgICBzZWN0aW9uSWRlbnRpdGllczogP0FycmF5PHN0cmluZz4sXG4gICAgcm93SWRlbnRpdGllczogP0FycmF5PEFycmF5PHN0cmluZz4+LFxuICApOiBMaXN0Vmlld0RhdGFTb3VyY2Uge1xuICAgIGludmFyaWFudChcbiAgICAgIHR5cGVvZiB0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICdNdXN0IHByb3ZpZGUgYSBzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCBmdW5jdGlvbiB3aXRoIHNlY3Rpb24gZGF0YS4nLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgIXNlY3Rpb25JZGVudGl0aWVzIHx8XG4gICAgICAgICFyb3dJZGVudGl0aWVzIHx8XG4gICAgICAgIHNlY3Rpb25JZGVudGl0aWVzLmxlbmd0aCA9PT0gcm93SWRlbnRpdGllcy5sZW5ndGgsXG4gICAgICAncm93IGFuZCBzZWN0aW9uIGlkcyBsZW5ndGhzIG11c3QgYmUgdGhlIHNhbWUnLFxuICAgICk7XG5cbiAgICBjb25zdCBuZXdTb3VyY2UgPSBuZXcgTGlzdFZpZXdEYXRhU291cmNlKHtcbiAgICAgIGdldFJvd0RhdGE6IHRoaXMuX2dldFJvd0RhdGEsXG4gICAgICBnZXRTZWN0aW9uSGVhZGVyRGF0YTogdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEsXG4gICAgICByb3dIYXNDaGFuZ2VkOiB0aGlzLl9yb3dIYXNDaGFuZ2VkLFxuICAgICAgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ6IHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkLFxuICAgIH0pO1xuICAgIG5ld1NvdXJjZS5fZGF0YUJsb2IgPSBkYXRhQmxvYjtcbiAgICBpZiAoc2VjdGlvbklkZW50aXRpZXMpIHtcbiAgICAgIG5ld1NvdXJjZS5zZWN0aW9uSWRlbnRpdGllcyA9IHNlY3Rpb25JZGVudGl0aWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMgPSBPYmplY3Qua2V5cyhkYXRhQmxvYik7XG4gICAgfVxuICAgIGlmIChyb3dJZGVudGl0aWVzKSB7XG4gICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcyA9IHJvd0lkZW50aXRpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzID0gW107XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMuZm9yRWFjaChzZWN0aW9uSUQgPT4ge1xuICAgICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcy5wdXNoKE9iamVjdC5rZXlzKGRhdGFCbG9iW3NlY3Rpb25JRF0pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBuZXdTb3VyY2UuX2NhY2hlZFJvd0NvdW50ID0gY291bnRSb3dzKG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzKTtcblxuICAgIG5ld1NvdXJjZS5fY2FsY3VsYXRlRGlydHlBcnJheXMoXG4gICAgICB0aGlzLl9kYXRhQmxvYixcbiAgICAgIHRoaXMuc2VjdGlvbklkZW50aXRpZXMsXG4gICAgICB0aGlzLnJvd0lkZW50aXRpZXMsXG4gICAgKTtcblxuICAgIHJldHVybiBuZXdTb3VyY2U7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRhdGEgc291cmNlLlxuICAgKlxuICAgKiBJZiB5b3UgYXJlIHNwZWNpZnlpbmcgdGhlIHJvd0lkZW50aXRpZXMgb3Igc2VjdGlvbklkZW50aXRpZXMsIHRoZW4gYGdldFJvd0NvdW50YCB3aWxsIHJldHVybiB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGZpbHRlcmVkIGRhdGEgc291cmNlLlxuICAgKi9cbiAgZ2V0Um93Q291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fY2FjaGVkUm93Q291bnQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIGRhdGEgc291cmNlIChzZWUgYGdldFJvd0NvdW50YCBmb3IgaG93IHRoaXMgaXMgY2FsY3VsYXRlZCkgcGx1cyB0aGUgbnVtYmVyIG9mIHNlY3Rpb25zIGluIHRoZSBkYXRhLlxuICAgKlxuICAgKiBJZiB5b3UgYXJlIHNwZWNpZnlpbmcgdGhlIHJvd0lkZW50aXRpZXMgb3Igc2VjdGlvbklkZW50aXRpZXMsIHRoZW4gYGdldFJvd0FuZFNlY3Rpb25Db3VudGAgd2lsbCByZXR1cm4gdGhlIG51bWJlciBvZiByb3dzICYgc2VjdGlvbnMgaW4gdGhlIGZpbHRlcmVkIGRhdGEgc291cmNlLlxuICAgKi9cbiAgZ2V0Um93QW5kU2VjdGlvbkNvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZFJvd0NvdW50ICsgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBpZiB0aGUgcm93IGlzIGRpcnRpZWQgYW5kIG5lZWRzIHRvIGJlIHJlcmVuZGVyZWRcbiAgICovXG4gIHJvd1Nob3VsZFVwZGF0ZShzZWN0aW9uSW5kZXg6IG51bWJlciwgcm93SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5lZWRzVXBkYXRlID0gdGhpcy5fZGlydHlSb3dzW3NlY3Rpb25JbmRleF1bcm93SW5kZXhdO1xuICAgIHdhcm5pbmcoXG4gICAgICBuZWVkc1VwZGF0ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ21pc3NpbmcgZGlydHlCaXQgZm9yIHNlY3Rpb24sIHJvdzogJyArIHNlY3Rpb25JbmRleCArICcsICcgKyByb3dJbmRleCxcbiAgICApO1xuICAgIHJldHVybiBuZWVkc1VwZGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBkYXRhIHJlcXVpcmVkIHRvIHJlbmRlciB0aGUgcm93LlxuICAgKi9cbiAgZ2V0Um93RGF0YShzZWN0aW9uSW5kZXg6IG51bWJlciwgcm93SW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgY29uc3Qgc2VjdGlvbklEID0gdGhpcy5zZWN0aW9uSWRlbnRpdGllc1tzZWN0aW9uSW5kZXhdO1xuICAgIGNvbnN0IHJvd0lEID0gdGhpcy5yb3dJZGVudGl0aWVzW3NlY3Rpb25JbmRleF1bcm93SW5kZXhdO1xuICAgIHdhcm5pbmcoXG4gICAgICBzZWN0aW9uSUQgIT09IHVuZGVmaW5lZCAmJiByb3dJRCAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ3JlbmRlcmluZyBpbnZhbGlkIHNlY3Rpb24sIHJvdzogJyArIHNlY3Rpb25JbmRleCArICcsICcgKyByb3dJbmRleCxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSByb3dJRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgb2Ygb3V0IG9mIHJhbmdlIGluZGV4ZXMuXG4gICAqL1xuICBnZXRSb3dJREZvckZsYXRJbmRleChpbmRleDogbnVtYmVyKTogP3N0cmluZyB7XG4gICAgbGV0IGFjY2Vzc0luZGV4ID0gaW5kZXg7XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBpZiAoYWNjZXNzSW5kZXggPj0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpIHtcbiAgICAgICAgYWNjZXNzSW5kZXggLT0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5yb3dJZGVudGl0aWVzW2lpXVthY2Nlc3NJbmRleF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNlY3Rpb25JRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgZm9yIG91dCBvZiByYW5nZSBpbmRleGVzLlxuICAgKi9cbiAgZ2V0U2VjdGlvbklERm9yRmxhdEluZGV4KGluZGV4OiBudW1iZXIpOiA/c3RyaW5nIHtcbiAgICBsZXQgYWNjZXNzSW5kZXggPSBpbmRleDtcbiAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGlmIChhY2Nlc3NJbmRleCA+PSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aCkge1xuICAgICAgICBhY2Nlc3NJbmRleCAtPSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW2lpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygcm93cyBpbiBlYWNoIHNlY3Rpb25cbiAgICovXG4gIGdldFNlY3Rpb25MZW5ndGhzKCk6IEFycmF5PG51bWJlcj4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIHJlc3VsdHMucHVzaCh0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgaWYgdGhlIHNlY3Rpb24gaGVhZGVyIGlzIGRpcnRpZWQgYW5kIG5lZWRzIHRvIGJlIHJlcmVuZGVyZWRcbiAgICovXG4gIHNlY3Rpb25IZWFkZXJTaG91bGRVcGRhdGUoc2VjdGlvbkluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBjb25zdCBuZWVkc1VwZGF0ZSA9IHRoaXMuX2RpcnR5U2VjdGlvbnNbc2VjdGlvbkluZGV4XTtcbiAgICB3YXJuaW5nKFxuICAgICAgbmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCxcbiAgICAgICdtaXNzaW5nIGRpcnR5Qml0IGZvciBzZWN0aW9uOiAnICsgc2VjdGlvbkluZGV4LFxuICAgICk7XG4gICAgcmV0dXJuIG5lZWRzVXBkYXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGRhdGEgcmVxdWlyZWQgdG8gcmVuZGVyIHRoZSBzZWN0aW9uIGhlYWRlclxuICAgKi9cbiAgZ2V0U2VjdGlvbkhlYWRlckRhdGEoc2VjdGlvbkluZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIGlmICghdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBzZWN0aW9uSUQgPSB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW3NlY3Rpb25JbmRleF07XG4gICAgd2FybmluZyhcbiAgICAgIHNlY3Rpb25JRCAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ3JlbmRlclNlY3Rpb24gY2FsbGVkIG9uIGludmFsaWQgc2VjdGlvbjogJyArIHNlY3Rpb25JbmRleCxcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YSh0aGlzLl9kYXRhQmxvYiwgc2VjdGlvbklEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1lbWJlcnMgYW5kIG1ldGhvZHMuXG4gICAqL1xuXG4gIF9nZXRSb3dEYXRhOiB0eXBlb2YgZGVmYXVsdEdldFJvd0RhdGE7XG4gIF9nZXRTZWN0aW9uSGVhZGVyRGF0YTogdHlwZW9mIGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YTtcbiAgX3Jvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGU7XG4gIF9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZDogP2RpZmZlclR5cGU7XG5cbiAgX2RhdGFCbG9iOiBhbnk7XG4gIF9kaXJ0eVJvd3M6IEFycmF5PEFycmF5PGJvb2xlYW4+PjtcbiAgX2RpcnR5U2VjdGlvbnM6IEFycmF5PGJvb2xlYW4+O1xuICBfY2FjaGVkUm93Q291bnQ6IG51bWJlcjtcblxuICAvLyBUaGVzZSB0d28gJ3Byb3RlY3RlZCcgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCBieSBMaXN0VmlldyB0byBpdGVyYXRlIG92ZXJcbiAgLy8gdGhlIGRhdGEgaW4gdGhpcyBjbGFzcy5cbiAgcm93SWRlbnRpdGllczogQXJyYXk8QXJyYXk8c3RyaW5nPj47XG4gIHNlY3Rpb25JZGVudGl0aWVzOiBBcnJheTxzdHJpbmc+O1xuXG4gIF9jYWxjdWxhdGVEaXJ0eUFycmF5cyhcbiAgICBwcmV2RGF0YUJsb2I6IGFueSxcbiAgICBwcmV2U2VjdGlvbklEczogQXJyYXk8c3RyaW5nPixcbiAgICBwcmV2Um93SURzOiBBcnJheTxBcnJheTxzdHJpbmc+PixcbiAgKTogdm9pZCB7XG4gICAgLy8gY29uc3RydWN0IGEgaGFzaG1hcCBvZiB0aGUgZXhpc3RpbmcgKG9sZCkgaWQgYXJyYXlzXG4gICAgY29uc3QgcHJldlNlY3Rpb25zSGFzaCA9IGtleWVkRGljdGlvbmFyeUZyb21BcnJheShwcmV2U2VjdGlvbklEcyk7XG4gICAgY29uc3QgcHJldlJvd3NIYXNoID0ge307XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHByZXZSb3dJRHMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICB2YXIgc2VjdGlvbklEID0gcHJldlNlY3Rpb25JRHNbaWldO1xuICAgICAgd2FybmluZyhcbiAgICAgICAgIXByZXZSb3dzSGFzaFtzZWN0aW9uSURdLFxuICAgICAgICAnU2VjdGlvbklEIGFwcGVhcnMgbW9yZSB0aGFuIG9uY2U6ICcgKyBzZWN0aW9uSUQsXG4gICAgICApO1xuICAgICAgcHJldlJvd3NIYXNoW3NlY3Rpb25JRF0gPSBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkocHJldlJvd0lEc1tpaV0pO1xuICAgIH1cblxuICAgIC8vIGNvbXBhcmUgdGhlIDIgaWRlbnRpdHkgYXJyYXkgYW5kIGdldCB0aGUgZGlydGllZCByb3dzXG4gICAgdGhpcy5fZGlydHlTZWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuX2RpcnR5Um93cyA9IFtdO1xuXG4gICAgbGV0IGRpcnR5O1xuICAgIGZvciAobGV0IHNJbmRleCA9IDA7IHNJbmRleCA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBzSW5kZXgrKykge1xuICAgICAgdmFyIHNlY3Rpb25JRCA9IHRoaXMuc2VjdGlvbklkZW50aXRpZXNbc0luZGV4XTtcbiAgICAgIC8vIGRpcnR5IGlmIHRoZSBzZWN0aW9uSGVhZGVyIGlzIG5ldyBvciBfc2VjdGlvbkhhc0NoYW5nZWQgaXMgdHJ1ZVxuICAgICAgZGlydHkgPSAhcHJldlNlY3Rpb25zSGFzaFtzZWN0aW9uSURdO1xuICAgICAgY29uc3Qgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSB0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZDtcbiAgICAgIGlmICghZGlydHkgJiYgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQpIHtcbiAgICAgICAgZGlydHkgPSBzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZChcbiAgICAgICAgICB0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YShwcmV2RGF0YUJsb2IsIHNlY3Rpb25JRCksXG4gICAgICAgICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEodGhpcy5fZGF0YUJsb2IsIHNlY3Rpb25JRCksXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zLnB1c2goISFkaXJ0eSk7XG5cbiAgICAgIHRoaXMuX2RpcnR5Um93c1tzSW5kZXhdID0gW107XG4gICAgICBmb3IgKFxuICAgICAgICBsZXQgckluZGV4ID0gMDtcbiAgICAgICAgckluZGV4IDwgdGhpcy5yb3dJZGVudGl0aWVzW3NJbmRleF0ubGVuZ3RoO1xuICAgICAgICBySW5kZXgrK1xuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IHJvd0lEID0gdGhpcy5yb3dJZGVudGl0aWVzW3NJbmRleF1bckluZGV4XTtcbiAgICAgICAgLy8gZGlydHkgaWYgdGhlIHNlY3Rpb24gaXMgbmV3LCByb3cgaXMgbmV3IG9yIF9yb3dIYXNDaGFuZ2VkIGlzIHRydWVcbiAgICAgICAgZGlydHkgPVxuICAgICAgICAgICFwcmV2U2VjdGlvbnNIYXNoW3NlY3Rpb25JRF0gfHxcbiAgICAgICAgICAhcHJldlJvd3NIYXNoW3NlY3Rpb25JRF1bcm93SURdIHx8XG4gICAgICAgICAgdGhpcy5fcm93SGFzQ2hhbmdlZChcbiAgICAgICAgICAgIHRoaXMuX2dldFJvd0RhdGEocHJldkRhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKSxcbiAgICAgICAgICAgIHRoaXMuX2dldFJvd0RhdGEodGhpcy5fZGF0YUJsb2IsIHNlY3Rpb25JRCwgcm93SUQpLFxuICAgICAgICAgICk7XG4gICAgICAgIHRoaXMuX2RpcnR5Um93c1tzSW5kZXhdLnB1c2goISFkaXJ0eSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvdW50Um93cyhhbGxSb3dJRHMpIHtcbiAgbGV0IHRvdGFsUm93cyA9IDA7XG4gIGZvciAobGV0IHNlY3Rpb25JZHggPSAwOyBzZWN0aW9uSWR4IDwgYWxsUm93SURzLmxlbmd0aDsgc2VjdGlvbklkeCsrKSB7XG4gICAgY29uc3Qgcm93SURzID0gYWxsUm93SURzW3NlY3Rpb25JZHhdO1xuICAgIHRvdGFsUm93cyArPSByb3dJRHMubGVuZ3RoO1xuICB9XG4gIHJldHVybiB0b3RhbFJvd3M7XG59XG5cbmZ1bmN0aW9uIGtleWVkRGljdGlvbmFyeUZyb21BcnJheShhcnIpIHtcbiAgaWYgKGlzRW1wdHkoYXJyKSkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IGFyci5sZW5ndGg7IGlpKyspIHtcbiAgICBjb25zdCBrZXkgPSBhcnJbaWldO1xuICAgIHdhcm5pbmcoIXJlc3VsdFtrZXldLCAnVmFsdWUgYXBwZWFycyBtb3JlIHRoYW4gb25jZSBpbiBhcnJheTogJyArIGtleSk7XG4gICAgcmVzdWx0W2tleV0gPSB0cnVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTGlzdFZpZXdEYXRhU291cmNlO1xuIl19