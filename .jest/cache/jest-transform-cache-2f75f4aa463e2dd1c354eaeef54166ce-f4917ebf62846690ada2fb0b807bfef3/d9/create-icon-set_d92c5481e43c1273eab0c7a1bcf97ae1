bbc10dde3787942b16d80ae1c7ac0ec1
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createIconSet;
exports.DEFAULT_ICON_COLOR = exports.DEFAULT_ICON_SIZE = exports.NativeIconAPI = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactNative = require("./react-native");

var _ensureNativeModuleAvailable = _interopRequireDefault(require("./ensure-native-module-available"));

var _iconButton = _interopRequireDefault(require("./icon-button"));

var _tabBarItemIos = _interopRequireDefault(require("./tab-bar-item-ios"));

var _toolbarAndroid = _interopRequireDefault(require("./toolbar-android"));

var NativeIconAPI = _reactNative.NativeModules.RNVectorIconsManager || _reactNative.NativeModules.RNVectorIconsModule;
exports.NativeIconAPI = NativeIconAPI;
var DEFAULT_ICON_SIZE = 12;
exports.DEFAULT_ICON_SIZE = DEFAULT_ICON_SIZE;
var DEFAULT_ICON_COLOR = 'black';
exports.DEFAULT_ICON_COLOR = DEFAULT_ICON_COLOR;

function createIconSet(glyphMap, fontFamily, fontFile, fontStyle) {
  var fontBasename = fontFile ? fontFile.replace(/\.(otf|ttf)$/, '') : fontFamily;

  var fontReference = _reactNative.Platform.select({
    windows: "Assets/" + fontFile + "#" + fontFamily,
    android: fontBasename,
    web: fontBasename,
    default: fontFamily
  });

  var IconNamePropType = _propTypes.default.oneOf(Object.keys(glyphMap));

  var Icon = function (_PureComponent) {
    (0, _inherits2.default)(Icon, _PureComponent);

    function Icon() {
      var _getPrototypeOf2;

      var _this;

      (0, _classCallCheck2.default)(this, Icon);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(Icon)).call.apply(_getPrototypeOf2, [this].concat(args)));
      (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "root", null);
      (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "handleRef", function (ref) {
        _this.root = ref;
      });
      return _this;
    }

    (0, _createClass2.default)(Icon, [{
      key: "setNativeProps",
      value: function setNativeProps(nativeProps) {
        if (this.root) {
          this.root.setNativeProps(nativeProps);
        }
      }
    }, {
      key: "render",
      value: function render() {
        var _this$props = this.props,
            name = _this$props.name,
            size = _this$props.size,
            color = _this$props.color,
            style = _this$props.style,
            children = _this$props.children,
            props = (0, _objectWithoutProperties2.default)(_this$props, ["name", "size", "color", "style", "children"]);
        var glyph = name ? glyphMap[name] || '?' : '';

        if (typeof glyph === 'number') {
          glyph = String.fromCharCode(glyph);
        }

        var styleDefaults = {
          fontSize: size,
          color: color
        };
        var styleOverrides = {
          fontFamily: fontReference,
          fontWeight: 'normal',
          fontStyle: 'normal'
        };
        props.style = [styleDefaults, style, styleOverrides, fontStyle || {}];
        props.ref = this.handleRef;
        return _react.default.createElement(_reactNative.Text, props, glyph, children);
      }
    }]);
    return Icon;
  }(_react.PureComponent);

  (0, _defineProperty2.default)(Icon, "propTypes", {
    allowFontScaling: _propTypes.default.bool,
    name: IconNamePropType,
    size: _propTypes.default.number,
    color: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),
    children: _propTypes.default.node,
    style: _propTypes.default.any
  });
  (0, _defineProperty2.default)(Icon, "defaultProps", {
    size: DEFAULT_ICON_SIZE,
    allowFontScaling: false
  });
  var imageSourceCache = {};

  function getImageSource(name) {
    var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_ICON_SIZE;
    var color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DEFAULT_ICON_COLOR;
    (0, _ensureNativeModuleAvailable.default)();
    var glyph = glyphMap[name] || '?';

    if (typeof glyph === 'number') {
      glyph = String.fromCharCode(glyph);
    }

    var processedColor = (0, _reactNative.processColor)(color);
    var cacheKey = glyph + ":" + size + ":" + processedColor;

    var scale = _reactNative.PixelRatio.get();

    return new Promise(function (resolve, reject) {
      var cached = imageSourceCache[cacheKey];

      if (typeof cached !== 'undefined') {
        if (!cached || cached instanceof Error) {
          reject(cached);
        } else {
          resolve({
            uri: cached,
            scale: scale
          });
        }
      } else {
        NativeIconAPI.getImageForFont(fontReference, glyph, size, processedColor, function (err, image) {
          var error = typeof err === 'string' ? new Error(err) : err;
          imageSourceCache[cacheKey] = image || error || false;

          if (!error && image) {
            resolve({
              uri: image,
              scale: scale
            });
          } else {
            reject(error);
          }
        });
      }
    });
  }

  function loadFont() {
    var file = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : fontFile;

    if (_reactNative.Platform.OS === 'ios') {
      (0, _ensureNativeModuleAvailable.default)();

      if (!file) {
        return Promise.reject(new Error('Unable to load font, because no file was specified. '));
      }

      return NativeIconAPI.loadFontWithFileName.apply(NativeIconAPI, (0, _toConsumableArray2.default)(file.split('.')));
    }

    return Promise.resolve();
  }

  function hasIcon(name) {
    return Object.prototype.hasOwnProperty.call(glyphMap, name);
  }

  function getRawGlyphMap() {
    return glyphMap;
  }

  function getFontFamily() {
    return fontReference;
  }

  Icon.Button = (0, _iconButton.default)(Icon);
  Icon.TabBarItem = (0, _tabBarItemIos.default)(IconNamePropType, getImageSource);
  Icon.TabBarItemIOS = Icon.TabBarItem;
  Icon.ToolbarAndroid = (0, _toolbarAndroid.default)(IconNamePropType, getImageSource);
  Icon.getImageSource = getImageSource;
  Icon.loadFont = loadFont;
  Icon.hasIcon = hasIcon;
  Icon.getRawGlyphMap = getRawGlyphMap;
  Icon.getFontFamily = getFontFamily;
  return Icon;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZS1pY29uLXNldC5qcyJdLCJuYW1lcyI6WyJOYXRpdmVJY29uQVBJIiwiTmF0aXZlTW9kdWxlcyIsIlJOVmVjdG9ySWNvbnNNYW5hZ2VyIiwiUk5WZWN0b3JJY29uc01vZHVsZSIsIkRFRkFVTFRfSUNPTl9TSVpFIiwiREVGQVVMVF9JQ09OX0NPTE9SIiwiY3JlYXRlSWNvblNldCIsImdseXBoTWFwIiwiZm9udEZhbWlseSIsImZvbnRGaWxlIiwiZm9udFN0eWxlIiwiZm9udEJhc2VuYW1lIiwicmVwbGFjZSIsImZvbnRSZWZlcmVuY2UiLCJQbGF0Zm9ybSIsInNlbGVjdCIsIndpbmRvd3MiLCJhbmRyb2lkIiwid2ViIiwiZGVmYXVsdCIsIkljb25OYW1lUHJvcFR5cGUiLCJQcm9wVHlwZXMiLCJvbmVPZiIsIk9iamVjdCIsImtleXMiLCJJY29uIiwicmVmIiwicm9vdCIsIm5hdGl2ZVByb3BzIiwic2V0TmF0aXZlUHJvcHMiLCJwcm9wcyIsIm5hbWUiLCJzaXplIiwiY29sb3IiLCJzdHlsZSIsImNoaWxkcmVuIiwiZ2x5cGgiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJzdHlsZURlZmF1bHRzIiwiZm9udFNpemUiLCJzdHlsZU92ZXJyaWRlcyIsImZvbnRXZWlnaHQiLCJoYW5kbGVSZWYiLCJQdXJlQ29tcG9uZW50IiwiYWxsb3dGb250U2NhbGluZyIsImJvb2wiLCJudW1iZXIiLCJvbmVPZlR5cGUiLCJzdHJpbmciLCJub2RlIiwiYW55IiwiaW1hZ2VTb3VyY2VDYWNoZSIsImdldEltYWdlU291cmNlIiwicHJvY2Vzc2VkQ29sb3IiLCJjYWNoZUtleSIsInNjYWxlIiwiUGl4ZWxSYXRpbyIsImdldCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY2FjaGVkIiwiRXJyb3IiLCJ1cmkiLCJnZXRJbWFnZUZvckZvbnQiLCJlcnIiLCJpbWFnZSIsImVycm9yIiwibG9hZEZvbnQiLCJmaWxlIiwiT1MiLCJsb2FkRm9udFdpdGhGaWxlTmFtZSIsInNwbGl0IiwiaGFzSWNvbiIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImdldFJhd0dseXBoTWFwIiwiZ2V0Rm9udEZhbWlseSIsIkJ1dHRvbiIsIlRhYkJhckl0ZW0iLCJUYWJCYXJJdGVtSU9TIiwiVG9vbGJhckFuZHJvaWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFRQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFTyxJQUFNQSxhQUFhLEdBQ3hCQywyQkFBY0Msb0JBQWQsSUFBc0NELDJCQUFjRSxtQkFEL0M7O0FBR0EsSUFBTUMsaUJBQWlCLEdBQUcsRUFBMUI7O0FBQ0EsSUFBTUMsa0JBQWtCLEdBQUcsT0FBM0I7OztBQUVRLFNBQVNDLGFBQVQsQ0FDYkMsUUFEYSxFQUViQyxVQUZhLEVBR2JDLFFBSGEsRUFJYkMsU0FKYSxFQUtiO0FBRUEsTUFBTUMsWUFBWSxHQUFHRixRQUFRLEdBQ3pCQSxRQUFRLENBQUNHLE9BQVQsQ0FBaUIsY0FBakIsRUFBaUMsRUFBakMsQ0FEeUIsR0FFekJKLFVBRko7O0FBSUEsTUFBTUssYUFBYSxHQUFHQyxzQkFBU0MsTUFBVCxDQUFnQjtBQUNwQ0MsSUFBQUEsT0FBTyxjQUFZUCxRQUFaLFNBQXdCRCxVQURLO0FBRXBDUyxJQUFBQSxPQUFPLEVBQUVOLFlBRjJCO0FBR3BDTyxJQUFBQSxHQUFHLEVBQUVQLFlBSCtCO0FBSXBDUSxJQUFBQSxPQUFPLEVBQUVYO0FBSjJCLEdBQWhCLENBQXRCOztBQU9BLE1BQU1ZLGdCQUFnQixHQUFHQyxtQkFBVUMsS0FBVixDQUFnQkMsTUFBTSxDQUFDQyxJQUFQLENBQVlqQixRQUFaLENBQWhCLENBQXpCOztBQWJBLE1BZU1rQixJQWZOO0FBQUE7O0FBQUE7QUFBQTs7QUFBQTs7QUFBQTs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSx5RkE4QlMsSUE5QlQ7QUFBQSw4RkFzQ2MsVUFBQUMsR0FBRyxFQUFJO0FBQ2pCLGNBQUtDLElB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akQsRUFBQUEsSUFBSSxDQUFDcUQsY0FBTCxHQUFzQkEsY0FBdEI7QUFDQXJELEVBQUFBLElBQUksQ0FBQ3NELGFBQUwsR0FBcUJBLGFBQXJCO0FBRUEsU0FBT3RELElBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQdXJlQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7XG4gIE5hdGl2ZU1vZHVsZXMsXG4gIFBsYXRmb3JtLFxuICBQaXhlbFJhdGlvLFxuICBwcm9jZXNzQ29sb3IsXG4gIFRleHQsXG59IGZyb20gJy4vcmVhY3QtbmF0aXZlJztcblxuaW1wb3J0IGVuc3VyZU5hdGl2ZU1vZHVsZUF2YWlsYWJsZSBmcm9tICcuL2Vuc3VyZS1uYXRpdmUtbW9kdWxlLWF2YWlsYWJsZSc7XG5pbXBvcnQgY3JlYXRlSWNvbkJ1dHRvbkNvbXBvbmVudCBmcm9tICcuL2ljb24tYnV0dG9uJztcbmltcG9ydCBjcmVhdGVUYWJCYXJJdGVtSU9TQ29tcG9uZW50IGZyb20gJy4vdGFiLWJhci1pdGVtLWlvcyc7XG5pbXBvcnQgY3JlYXRlVG9vbGJhckFuZHJvaWRDb21wb25lbnQgZnJvbSAnLi90b29sYmFyLWFuZHJvaWQnO1xuXG5leHBvcnQgY29uc3QgTmF0aXZlSWNvbkFQSSA9XG4gIE5hdGl2ZU1vZHVsZXMuUk5WZWN0b3JJY29uc01hbmFnZXIgfHwgTmF0aXZlTW9kdWxlcy5STlZlY3Rvckljb25zTW9kdWxlO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9JQ09OX1NJWkUgPSAxMjtcbmV4cG9ydCBjb25zdCBERUZBVUxUX0lDT05fQ09MT1IgPSAnYmxhY2snO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVJY29uU2V0KFxuICBnbHlwaE1hcCxcbiAgZm9udEZhbWlseSxcbiAgZm9udEZpbGUsXG4gIGZvbnRTdHlsZVxuKSB7XG4gIC8vIEFuZHJvaWQgZG9lc24ndCBjYXJlIGFib3V0IGFjdHVhbCBmb250RmFtaWx5IG5hbWUsIGl0IHdpbGwgb25seSBsb29rIGluIGZvbnRzIGZvbGRlci5cbiAgY29uc3QgZm9udEJhc2VuYW1lID0gZm9udEZpbGVcbiAgICA/IGZvbnRGaWxlLnJlcGxhY2UoL1xcLihvdGZ8dHRmKSQvLCAnJylcbiAgICA6IGZvbnRGYW1pbHk7XG5cbiAgY29uc3QgZm9udFJlZmVyZW5jZSA9IFBsYXRmb3JtLnNlbGVjdCh7XG4gICAgd2luZG93czogYEFzc2V0cy8ke2ZvbnRGaWxlfSMke2ZvbnRGYW1pbHl9YCxcbiAgICBhbmRyb2lkOiBmb250QmFzZW5hbWUsXG4gICAgd2ViOiBmb250QmFzZW5hbWUsXG4gICAgZGVmYXVsdDogZm9udEZhbWlseSxcbiAgfSk7XG5cbiAgY29uc3QgSWNvbk5hbWVQcm9wVHlwZSA9IFByb3BUeXBlcy5vbmVPZihPYmplY3Qua2V5cyhnbHlwaE1hcCkpO1xuXG4gIGNsYXNzIEljb24gZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgYWxsb3dGb250U2NhbGluZzogUHJvcFR5cGVzLmJvb2wsXG4gICAgICBuYW1lOiBJY29uTmFtZVByb3BUeXBlLFxuICAgICAgc2l6ZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICAgIGNvbG9yOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMubnVtYmVyXSksXG4gICAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG4gICAgICBzdHlsZTogUHJvcFR5cGVzLmFueSwgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC9mb3JiaWQtcHJvcC10eXBlc1xuICAgIH07XG5cbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgc2l6ZTogREVGQVVMVF9JQ09OX1NJWkUsXG4gICAgICBhbGxvd0ZvbnRTY2FsaW5nOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgcm9vdCA9IG51bGw7XG5cbiAgICBzZXROYXRpdmVQcm9wcyhuYXRpdmVQcm9wcykge1xuICAgICAgaWYgKHRoaXMucm9vdCkge1xuICAgICAgICB0aGlzLnJvb3Quc2V0TmF0aXZlUHJvcHMobmF0aXZlUHJvcHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZVJlZiA9IHJlZiA9PiB7XG4gICAgICB0aGlzLnJvb3QgPSByZWY7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGNvbnN0IHsgbmFtZSwgc2l6ZSwgY29sb3IsIHN0eWxlLCBjaGlsZHJlbiwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgIGxldCBnbHlwaCA9IG5hbWUgPyBnbHlwaE1hcFtuYW1lXSB8fCAnPycgOiAnJztcbiAgICAgIGlmICh0eXBlb2YgZ2x5cGggPT09ICdudW1iZXInKSB7XG4gICAgICAgIGdseXBoID0gU3RyaW5nLmZyb21DaGFyQ29kZShnbHlwaCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0eWxlRGVmYXVsdHMgPSB7XG4gICAgICAgIGZvbnRTaXplOiBzaXplLFxuICAgICAgICBjb2xvcixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHN0eWxlT3ZlcnJpZGVzID0ge1xuICAgICAgICBmb250RmFtaWx5OiBmb250UmVmZXJlbmNlLFxuICAgICAgICBmb250V2VpZ2h0OiAnbm9ybWFsJyxcbiAgICAgICAgZm9udFN0eWxlOiAnbm9ybWFsJyxcbiAgICAgIH07XG5cbiAgICAgIHByb3BzLnN0eWxlID0gW3N0eWxlRGVmYXVsdHMsIHN0eWxlLCBzdHlsZU92ZXJyaWRlcywgZm9udFN0eWxlIHx8IHt9XTtcbiAgICAgIHByb3BzLnJlZiA9IHRoaXMuaGFuZGxlUmVmO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dCB7Li4ucHJvcHN9PlxuICAgICAgICAgIHtnbHlwaH1cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvVGV4dD5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaW1hZ2VTb3VyY2VDYWNoZSA9IHt9O1xuXG4gIGZ1bmN0aW9uIGdldEltYWdlU291cmNlKFxuICAgIG5hbWUsXG4gICAgc2l6ZSA9IERFRkFVTFRfSUNPTl9TSVpFLFxuICAgIGNvbG9yID0gREVGQVVMVF9JQ09OX0NPTE9SXG4gICkge1xuICAgIGVuc3VyZU5hdGl2ZU1vZHVsZUF2YWlsYWJsZSgpO1xuXG4gICAgbGV0IGdseXBoID0gZ2x5cGhNYXBbbmFtZV0gfHwgJz8nO1xuICAgIGlmICh0eXBlb2YgZ2x5cGggPT09ICdudW1iZXInKSB7XG4gICAgICBnbHlwaCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZ2x5cGgpO1xuICAgIH1cblxuICAgIGNvbnN0IHByb2Nlc3NlZENvbG9yID0gcHJvY2Vzc0NvbG9yKGNvbG9yKTtcbiAgICBjb25zdCBjYWNoZUtleSA9IGAke2dseXBofToke3NpemV9OiR7cHJvY2Vzc2VkQ29sb3J9YDtcbiAgICBjb25zdCBzY2FsZSA9IFBpeGVsUmF0aW8uZ2V0KCk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGVkID0gaW1hZ2VTb3VyY2VDYWNoZVtjYWNoZUtleV07XG4gICAgICBpZiAodHlwZW9mIGNhY2hlZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgaWYgKCFjYWNoZWQgfHwgY2FjaGVkIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgICByZWplY3QoY2FjaGVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHsgdXJpOiBjYWNoZWQsIHNjYWxlIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBOYXRpdmVJY29uQVBJLmdldEltYWdlRm9yRm9udChcbiAgICAgICAgICBmb250UmVmZXJlbmNlLFxuICAgICAgICAgIGdseXBoLFxuICAgICAgICAgIHNpemUsXG4gICAgICAgICAgcHJvY2Vzc2VkQ29sb3IsXG4gICAgICAgICAgKGVyciwgaW1hZ2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gdHlwZW9mIGVyciA9PT0gJ3N0cmluZycgPyBuZXcgRXJyb3IoZXJyKSA6IGVycjtcbiAgICAgICAgICAgIGltYWdlU291cmNlQ2FjaGVbY2FjaGVLZXldID0gaW1hZ2UgfHwgZXJyb3IgfHwgZmFsc2U7XG4gICAgICAgICAgICBpZiAoIWVycm9yICYmIGltYWdlKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUoeyB1cmk6IGltYWdlLCBzY2FsZSB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9hZEZvbnQoZmlsZSA9IGZvbnRGaWxlKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgZW5zdXJlTmF0aXZlTW9kdWxlQXZhaWxhYmxlKCk7XG4gICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICAgIG5ldyBFcnJvcignVW5hYmxlIHRvIGxvYWQgZm9udCwgYmVjYXVzZSBubyBmaWxlIHdhcyBzcGVjaWZpZWQuICcpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmF0aXZlSWNvbkFQSS5sb2FkRm9udFdpdGhGaWxlTmFtZSguLi5maWxlLnNwbGl0KCcuJykpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNJY29uKG5hbWUpIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGdseXBoTWFwLCBuYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFJhd0dseXBoTWFwKCkge1xuICAgIHJldHVybiBnbHlwaE1hcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEZvbnRGYW1pbHkoKSB7XG4gICAgcmV0dXJuIGZvbnRSZWZlcmVuY2U7XG4gIH1cblxuICBJY29uLkJ1dHRvbiA9IGNyZWF0ZUljb25CdXR0b25Db21wb25lbnQoSWNvbik7XG4gIEljb24uVGFiQmFySXRlbSA9IGNyZWF0ZVRhYkJhckl0ZW1JT1NDb21wb25lbnQoXG4gICAgSWNvbk5hbWVQcm9wVHlwZSxcbiAgICBnZXRJbWFnZVNvdXJjZVxuICApO1xuICBJY29uLlRhYkJhckl0ZW1JT1MgPSBJY29uLlRhYkJhckl0ZW07XG4gIEljb24uVG9vbGJhckFuZHJvaWQgPSBjcmVhdGVUb29sYmFyQW5kcm9pZENvbXBvbmVudChcbiAgICBJY29uTmFtZVByb3BUeXBlLFxuICAgIGdldEltYWdlU291cmNlXG4gICk7XG4gIEljb24uZ2V0SW1hZ2VTb3VyY2UgPSBnZXRJbWFnZVNvdXJjZTtcbiAgSWNvbi5sb2FkRm9udCA9IGxvYWRGb250O1xuICBJY29uLmhhc0ljb24gPSBoYXNJY29uO1xuICBJY29uLmdldFJhd0dseXBoTWFwID0gZ2V0UmF3R2x5cGhNYXA7XG4gIEljb24uZ2V0Rm9udEZhbWlseSA9IGdldEZvbnRGYW1pbHk7XG5cbiAgcmV0dXJuIEljb247XG59XG4iXX0=